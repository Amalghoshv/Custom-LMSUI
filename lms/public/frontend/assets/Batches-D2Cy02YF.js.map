{"version":3,"file":"Batches-D2Cy02YF.js","sources":["../../../../frontend/src/pages/Batches.vue"],"sourcesContent":["<template>\n\t<header\n\t\tclass=\"sticky flex items-center justify-between top-0 z-10 border-b bg-surface-white px-3 py-2.5 sm:px-5\"\n\t>\n\t\t<Breadcrumbs :items=\"breadcrumbs\" />\n\t\t<router-link\n\t\t\tv-if=\"user.data?.is_moderator\"\n\t\t\t:to=\"{\n\t\t\t\tname: 'BatchForm',\n\t\t\t\tparams: { batchName: 'new' },\n\t\t\t}\"\n\t\t>\n\t\t\t<Button variant=\"solid\">\n\t\t\t\t<template #prefix>\n\t\t\t\t\t<Plus class=\"h-4 w-4 stroke-1.5\" />\n\t\t\t\t</template>\n\t\t\t\t{{ __('New') }}\n\t\t\t</Button>\n\t\t</router-link>\n\t</header>\n\t<div class=\"p-5 pb-10\">\n\t\t<div\n\t\t\tclass=\"flex flex-col lg:flex-row space-y-4 lg:space-y-0 lg:items-center justify-between mb-5\"\n\t\t>\n\t\t\t<div class=\"text-lg font-semibold\">\n\t\t\t\t{{ __('All Batches') }}\n\t\t\t</div>\n\t\t\t<div\n\t\t\t\tclass=\"flex flex-col space-y-2 lg:space-y-0 lg:flex-row lg:items-center lg:space-x-2\"\n\t\t\t>\n\t\t\t\t<TabButtons\n\t\t\t\t\tv-if=\"user.data\"\n\t\t\t\t\t:buttons=\"batchTabs\"\n\t\t\t\t\tv-model=\"currentTab\"\n\t\t\t\t/>\n\t\t\t\t<div class=\"grid grid-cols-2 gap-2\">\n\t\t\t\t\t<FormControl\n\t\t\t\t\t\tv-model=\"title\"\n\t\t\t\t\t\t:placeholder=\"__('Search by Title')\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tclass=\"min-w-40 lg:min-w-0 lg:w-32 xl:w-40\"\n\t\t\t\t\t\t@input=\"updateBatches()\"\n\t\t\t\t\t/>\n\t\t\t\t\t<div class=\"min-w-40 lg:min-w-0 lg:w-32 xl:w-40\">\n\t\t\t\t\t\t<Select\n\t\t\t\t\t\t\tv-if=\"categories.length\"\n\t\t\t\t\t\t\tv-model=\"currentCategory\"\n\t\t\t\t\t\t\t:options=\"categories\"\n\t\t\t\t\t\t\t:placeholder=\"__('Category')\"\n\t\t\t\t\t\t\t@change=\"updateBatches()\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div\n\t\t\tv-if=\"batches.data?.length\"\n\t\t\tclass=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5\"\n\t\t>\n\t\t\t<router-link\n\t\t\t\tv-for=\"batch in batches.data\"\n\t\t\t\t:to=\"{ name: 'BatchDetail', params: { batchName: batch.name } }\"\n\t\t\t>\n\t\t\t\t<BatchCard :batch=\"batch\" />\n\t\t\t</router-link>\n\t\t</div>\n\t\t<div\n\t\t\tv-else-if=\"!batches.list.loading\"\n\t\t\tclass=\"flex flex-col items-center justify-center text-sm text-ink-gray-5 italic mt-48\"\n\t\t>\n\t\t\t<BookOpen class=\"size-10 mx-auto stroke-1 text-ink-gray-4\" />\n\t\t\t<div class=\"text-lg font-medium mb-1\">\n\t\t\t\t{{ __('No batches found') }}\n\t\t\t</div>\n\t\t\t<div class=\"leading-5 w-2/5 text-center\">\n\t\t\t\t{{\n\t\t\t\t\t__(\n\t\t\t\t\t\t'There are no batches matching the criteria. Keep an eye out, fresh learning experiences are on the way soon!'\n\t\t\t\t\t)\n\t\t\t\t}}\n\t\t\t</div>\n\t\t</div>\n\t\t<div\n\t\t\tv-if=\"!batches.list.loading && batches.hasNextPage\"\n\t\t\tclass=\"flex justify-center mt-5\"\n\t\t>\n\t\t\t<Button @click=\"batches.next()\">\n\t\t\t\t{{ __('Load More') }}\n\t\t\t</Button>\n\t\t</div>\n\t</div>\n</template>\n<script setup>\nimport {\n\tBreadcrumbs,\n\tButton,\n\tcreateListResource,\n\tFormControl,\n\tSelect,\n\tTabButtons,\n} from 'frappe-ui'\nimport { computed, inject, onMounted, ref, watch } from 'vue'\nimport { BookOpen, Plus } from 'lucide-vue-next'\nimport { updateDocumentTitle } from '@/utils'\nimport BatchCard from '@/components/BatchCard.vue'\n\nconst user = inject('$user')\nconst dayjs = inject('$dayjs')\nconst start = ref(0)\nconst pageLength = ref(20)\nconst categories = ref([])\nconst currentCategory = ref(null)\nconst title = ref('')\nconst filters = ref({})\nconst currentTab = ref(user.data?.is_student ? 'All' : 'Upcoming')\nconst orderBy = ref('start_date')\n\nonMounted(() => {\n\tsetFiltersFromQuery()\n\tupdateBatches()\n\tcategories.value = [\n\t\t{\n\t\t\tlabel: '',\n\t\t\tvalue: null,\n\t\t},\n\t]\n})\n\nconst setFiltersFromQuery = () => {\n\tlet queries = new URLSearchParams(location.search)\n\ttitle.value = queries.get('title') || ''\n\tcurrentCategory.value = queries.get('category') || null\n}\n\nconst batches = createListResource({\n\tdoctype: 'LMS Batch',\n\turl: 'lms.lms.utils.get_batches',\n\tcache: ['batches', user.data?.name],\n\tpageLength: pageLength.value,\n\tstart: start.value,\n\tonSuccess(data) {\n\t\tlet allCategories = data.map((batch) => batch.category)\n\t\tallCategories = allCategories.filter(\n\t\t\t(category, index) => allCategories.indexOf(category) === index && category\n\t\t)\n\t\tif (categories.value.length <= allCategories.length) {\n\t\t\tupdateCategories(data)\n\t\t}\n\t},\n})\n\nconst updateBatches = () => {\n\tupdateFilters()\n\tbatches.update({\n\t\tfilters: filters.value,\n\t\torderBy: orderBy.value,\n\t})\n\tbatches.reload()\n}\n\nconst updateFilters = () => {\n\tupdateCategoryFilter()\n\tupdateTitleFilter()\n\tupdateTabFilter()\n\tupdateStudentFilter()\n\tsetQueryParams()\n}\n\nconst updateCategoryFilter = () => {\n\tif (currentCategory.value) {\n\t\tfilters.value['category'] = currentCategory.value\n\t} else {\n\t\tdelete filters.value['category']\n\t}\n}\n\nconst updateTitleFilter = () => {\n\tif (title.value) {\n\t\tfilters.value['title'] = ['like', `%${title.value}%`]\n\t} else {\n\t\tdelete filters.value['title']\n\t}\n}\n\nconst updateTabFilter = () => {\n\torderBy.value = 'start_date'\n\tif (!user.data) {\n\t\treturn\n\t}\n\tif (currentTab.value == 'Enrolled' && user.data?.is_student) {\n\t\tfilters.value['enrolled'] = 1\n\t\tdelete filters.value['start_date']\n\t\tdelete filters.value['published']\n\t\torderBy.value = 'start_date desc'\n\t} else if (user.data?.is_student) {\n\t\tdelete filters.value['enrolled']\n\t} else {\n\t\tdelete filters.value['start_date']\n\t\tdelete filters.value['published']\n\t\torderBy.value = 'start_date desc'\n\t\tif (currentTab.value == 'Upcoming') {\n\t\t\tfilters.value['start_date'] = ['>=', dayjs().format('YYYY-MM-DD')]\n\t\t\tfilters.value['published'] = 1\n\t\t\torderBy.value = 'start_date'\n\t\t} else if (currentTab.value == 'Archived') {\n\t\t\tfilters.value['start_date'] = ['<=', dayjs().format('YYYY-MM-DD')]\n\t\t} else if (currentTab.value == 'Unpublished') {\n\t\t\tfilters.value['published'] = 0\n\t\t}\n\t}\n}\n\nconst updateStudentFilter = () => {\n\tif (!user.data || (user.data?.is_student && currentTab.value != 'Enrolled')) {\n\t\tfilters.value['start_date'] = ['>=', dayjs().format('YYYY-MM-DD')]\n\t\tfilters.value['published'] = 1\n\t}\n}\n\nconst setQueryParams = () => {\n\tlet queries = new URLSearchParams(location.search)\n\tlet filterKeys = {\n\t\ttitle: title.value,\n\t\tcategory: currentCategory.value,\n\t}\n\n\tObject.keys(filterKeys).forEach((key) => {\n\t\tif (filterKeys[key]) {\n\t\t\tqueries.set(key, filterKeys[key])\n\t\t} else {\n\t\t\tqueries.delete(key)\n\t\t}\n\t})\n\n\thistory.replaceState({}, '', `${location.pathname}?${queries.toString()}`)\n}\n\nconst updateCategories = (data) => {\n\tdata.forEach((batch) => {\n\t\tif (\n\t\t\tbatch.category &&\n\t\t\t!categories.value.find((category) => category.value === batch.category)\n\t\t)\n\t\t\tcategories.value.push({\n\t\t\t\tlabel: batch.category,\n\t\t\t\tvalue: batch.category,\n\t\t\t})\n\t})\n}\n\nwatch(currentTab, () => {\n\tupdateBatches()\n})\n\nconst batchType = computed(() => {\n\tlet types = [\n\t\t{ label: __(''), value: null },\n\t\t{ label: __('Upcoming'), value: 'Upcoming' },\n\t\t{ label: __('Archived'), value: 'Archived' },\n\t]\n\tif (user.data?.is_moderator) {\n\t\ttypes.push({ label: __('Unpublished'), value: 'Unpublished' })\n\t}\n\treturn types\n})\n\nconst batchTabs = computed(() => {\n\tlet tabs = [\n\t\t{\n\t\t\tlabel: __('All'),\n\t\t},\n\t]\n\tif (user.data?.is_student) {\n\t\ttabs.push({ label: __('Enrolled') })\n\t} else {\n\t\ttabs.push({ label: __('Upcoming') })\n\t\ttabs.push({ label: __('Archived') })\n\t\ttabs.push({ label: __('Unpublished') })\n\t}\n\treturn tabs\n})\n\nconst breadcrumbs = computed(() => [\n\t{\n\t\tlabel: __('Batches'),\n\t\troute: { name: 'Batches' },\n\t},\n])\n\nconst pageMeta = computed(() => {\n\treturn {\n\t\ttitle: 'Batches',\n\t\tdescription: 'All upcoming batches.',\n\t}\n})\n\nupdateDocumentTitle(pageMeta)\n</script>\n"],"names":["user","inject","dayjs","start","ref","pageLength","categories","currentCategory","title","filters","currentTab","_a","orderBy","onMounted","setFiltersFromQuery","updateBatches","queries","batches","createListResource","_b","data","allCategories","batch","category","index","updateCategories","updateFilters","updateCategoryFilter","updateTitleFilter","updateTabFilter","updateStudentFilter","setQueryParams","filterKeys","key","watch","computed","types","batchTabs","tabs","breadcrumbs","pageMeta","updateDocumentTitle"],"mappings":"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"}