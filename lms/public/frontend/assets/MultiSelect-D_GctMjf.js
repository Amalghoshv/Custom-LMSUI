import{aq as j,ar as I,r as d,d as b,a4 as P,j as U,G as m,x as n,H as M,z as o,B as S,a5 as X,I as w,L as B,M as F,v as K,y as f,J as v,C as i,b3 as $,ap as q,K as G,W as H,N as J,Y as W,Z as Y,O as Z,X as A,a3 as Q,n as R}from"./frappe-ui-2-dobwEi.js";import{a1 as ee}from"./index-Dg_4Jaqk.js";const te={key:0,class:"text-ink-red-3"},se={class:"grid grid-cols-3 gap-1"},ae={class:""},le={class:"mt-1 rounded-lg bg-surface-white py-1 text-base shadow-2xl"},oe={class:"flex flex-col gap-1 p-1"},ue={class:"text-base font-medium"},re={class:"text-sm text-ink-gray-5"},ce={__name:"MultiSelect",props:j({label:{type:String},size:{type:String,default:"sm"},doctype:{type:String,required:!0},filters:{type:Object,default:()=>({})},validate:{type:Function,default:null},errorMessage:{type:Function,default:u=>`${u} is an Invalid value`},required:{type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u,{expose:N}){const r=u,l=I(u,"modelValue"),p=d([]),k=d(null),x=d(null),c=d(""),y=d(""),h=d(!1),_=b({get:()=>c.value||"",set:e=>{c.value="",e&&(h.value=!1),e!=null&&e.value&&D(e.value)}});P(c,e=>{e=e||"",y.value!==e&&(y.value=e,z(e))},{debounce:300,immediate:!0});const g=U({url:"frappe.desk.search.search_link",method:"POST",cache:[y.value,r.doctype],auto:!0,params:{txt:y.value,doctype:r.doctype}}),O=b(()=>g.data||[]);function z(e){g.update({params:{txt:e,doctype:r.doctype}}),g.reload()}const D=e=>{x.value=null,e&&(e.split(",").forEach(t=>{var a;if(t=t.trim(),t&&!((a=l.value)!=null&&a.includes(t))){if(t&&r.validate&&!r.validate(t)){x.value=r.errorMessage(t);return}l.value?l.value.push(t):l.value=[t],t=t.replace(t,"")}}),!x.value&&(e=""))},E=e=>{l.value=l.value.filter(s=>s!==e)},V=()=>{var s;if(c.value)return;let e=(s=p.value[p.value.length-1])==null?void 0:s.$el;document.activeElement===e?(l.value.pop(),R(()=>{l.value.length?(e=p.value[p.value.length-1].$el,e==null||e.focus()):C()})):e==null||e.focus()};function C(){k.value.$el.focus()}N({setFocus:C});const L=b(()=>[{sm:"text-xs",md:"text-base"}[r.size||"sm"],"text-ink-gray-5"]);return(e,s)=>(n(),m("div",null,[u.label?(n(),m("label",{key:0,class:S(["block mb-1",L.value])},[X(w(u.label)+" ",1),u.required?(n(),m("span",te,"*")):M("",!0)],2)):M("",!0),o("div",se,[(n(!0),m(B,null,F(l.value,t=>(n(),K(i(G),{ref_for:!0,ref_key:"emails",ref:p,key:t,label:t,theme:"gray",variant:"subtle",class:"rounded-md",onKeydownCapture:$(q(V,["stop"]),["delete"])},{suffix:f(()=>[v(i(ee),{onClick:a=>E(t),class:"h-4 w-4 stroke-1.5"},null,8,["onClick"])]),_:2},1032,["label","onKeydownCapture"]))),128)),o("div",ae,[v(i(Q),{modelValue:_.value,"onUpdate:modelValue":s[2]||(s[2]=t=>_.value=t),nullable:""},{default:f(()=>[v(i(H),{class:"w-full",show:h.value,"onUpdate:show":s[1]||(s[1]=t=>h.value=t)},{target:f(({togglePopover:t})=>[v(i(A),{ref_key:"search",ref:k,class:"search-input form-input w-full focus-visible:!ring-0",type:"text",value:c.value,onChange:s[0]||(s[0]=a=>{c.value=a.target.value,h.value=!0}),autocomplete:"off",onFocus:()=>t(),onKeydownCapture:$(q(V,["stop"]),["delete"])},null,8,["value","onFocus","onKeydownCapture"])]),body:f(({isOpen:t})=>[J(o("div",null,[o("div",le,[v(i(W),{class:"my-1 max-h-[12rem] overflow-y-auto px-1.5",static:""},{default:f(()=>[(n(!0),m(B,null,F(O.value,a=>(n(),K(i(Y),{key:a.value,value:a},{default:f(({active:T})=>[o("li",{class:S(["flex cursor-pointer items-center rounded px-2 py-1 text-base",{"bg-surface-gray-2":T}])},[o("div",oe,[o("div",ue,w(a.description),1),o("div",re,w(a.value),1)])],2)]),_:2},1032,["value"]))),128))]),_:1})])],512),[[Z,t]])]),_:1},8,["show"])]),_:1},8,["modelValue"])])])]))}};export{ce as _};
//# sourceMappingURL=MultiSelect-D_GctMjf.js.map
