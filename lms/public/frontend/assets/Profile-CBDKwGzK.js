var O=Object.defineProperty;var L=Object.getOwnPropertySymbols;var D=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var M=(_,m,l)=>m in _?O(_,m,{enumerable:!0,configurable:!0,writable:!0,value:l}):_[m]=l,R=(_,m)=>{for(var l in m||(m={}))D.call(m,l)&&M(_,l,m[l]);if(L)for(var l of L(m))G.call(m,l)&&M(_,l,m[l]);return _};import{f as z,ay as q,G as y,x as c,z as o,H as S,a5 as w,I as f,C as e,J as u,y as p,K as C,aq as J,ar as K,a as W,j as U,w as I,v as P,a9 as A,P as E,T as X,q as Y,r as F,b0 as Z,L as H,M as Q,$ as ee,a1 as se,a2 as ae,W as te,s as oe,aJ as le,b1 as re,d as B,aG as ie,B as ne,aL as de,i as ue,F as me}from"./frappe-ui-2-dobwEi.js";import{Z as ce,$ as fe,a0 as pe,a1 as _e,s as ve,a2 as ge,y as be,b as he,a3 as N}from"./index-Dg_4Jaqk.js";import{_ as xe}from"./UserAvatar-B6Y_HQLv.js";const ye={class:"border rounded-md w-1/3 mx-auto my-32"},ke={class:"border-b px-5 py-3 font-medium"},$e={key:0,class:"px-5 py-3"},we={class:"px-5 py-3"},Pe={__name:"NoPermission",setup(_){const m=z("$user"),l=()=>{window.location.href="/login"};return(a,x)=>{const g=q("router-link");return c(),y("div",ye,[o("div",ke,[x[1]||(x[1]=o("span",{class:"inline-flex items-center before:bg-surface-red-5 before:w-2 before:h-2 before:rounded-md before:mr-2"},null,-1)),w(" "+f(a.__("Not Permitted")),1)]),e(m).data?(c(),y("div",$e,[o("div",null,f(a.__("You do not have permission to access this page.")),1),u(g,{to:{name:"Courses"}},{default:p(()=>[u(e(C),{variant:"solid",class:"mt-2"},{default:p(()=>[w(f(a.__("Checkout Courses")),1)]),_:1})]),_:1})])):S("",!0),o("div",we,[o("div",null,f(a.__("Please login to access this page.")),1),u(e(C),{onClick:x[0]||(x[0]=$=>l()),class:"mt-4"},{default:p(()=>[w(f(a.__("Login")),1)]),_:1})])])}}},Ce={class:"mb-4"},Se={key:1,class:"mb-4"},Ue={class:"text-xs text-ink-gray-5 mb-1"},Te={class:"flex items-center"},Ve={class:"border rounded-md p-2 mr-2"},je={class:"text-base flex flex-col"},Ee={class:"text-sm text-ink-gray-4 mt-1"},Fe={class:"mb-4"},Ie={class:"mb-1.5 text-sm text-ink-gray-5"},Le={__name:"EditProfile",props:J({profile:{type:Object,required:!0}},{reloadProfile:{},reloadProfileModifiers:{}}),emits:["update:reloadProfile"],setup(_){const m=K(_,"reloadProfile"),l=_,a=W({first_name:"",last_name:"",headline:"",bio:"",image:""}),x=U({url:"lms.lms.api.get_file_info",makeParams(s){return{file_url:s.image}},auto:!1,onSuccess(s){a.image=s}}),g=U({url:"frappe.client.set_value",makeParams(s){return a.bio=ce(a.bio),{doctype:"User",name:l.profile.data.name,fieldname:R({user_image:a.image.file_url},a)}},onSuccess(s){l.profile.data=s}}),$=s=>{g.submit({},{onSuccess(){s(),m.value.reload()},onError(i){var n;ve("Error",((n=i.messages)==null?void 0:n[0])||i,"x")}})},b=s=>{let i=s.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(i))return"Only image file is allowed."},t=s=>{a.image=s},v=()=>{a.image=null};return I(()=>l.profile.data,s=>{s&&(a.first_name=s.first_name,a.last_name=s.last_name,a.headline=s.headline,a.bio=s.bio,s.user_image&&x.submit({image:s.user_image}))}),(s,i)=>(c(),P(e(Y),{options:{title:"Edit your profile",size:"xl",actions:[{label:"Save",variant:"solid",onClick:n=>$(n)}]}},{"body-content":p(()=>[o("div",null,[a.image?(c(),y("div",Se,[o("div",Ue,f(s.__("Profile Image")),1),o("div",Te,[o("div",Ve,[u(e(fe),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),o("div",je,[o("span",null,f(a.image.file_name),1),o("span",Ee,f(e(pe)(a.image.file_size)),1)]),u(e(_e),{onClick:i[1]||(i[1]=n=>v()),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(c(),P(e(A),{key:0,fileTypes:["image/*"],validateFile:b,onSuccess:i[0]||(i[0]=n=>t(n))},{default:p(({file:n,progress:V,uploading:T,openFileSelector:j})=>[o("div",Ce,[u(e(C),{onClick:j,loading:T},{default:p(()=>[w(f(T?`Uploading ${V}%`:"Upload a profile image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})),u(e(E),{modelValue:a.first_name,"onUpdate:modelValue":i[2]||(i[2]=n=>a.first_name=n),label:s.__("First Name"),class:"mb-4"},null,8,["modelValue","label"]),u(e(E),{modelValue:a.last_name,"onUpdate:modelValue":i[3]||(i[3]=n=>a.last_name=n),label:s.__("Last Name"),class:"mb-4"},null,8,["modelValue","label"]),u(e(E),{modelValue:a.headline,"onUpdate:modelValue":i[4]||(i[4]=n=>a.headline=n),label:s.__("Headline"),class:"mb-4"},null,8,["modelValue","label"]),o("div",Fe,[o("div",Ie,f(s.__("Bio")),1),u(e(X),{fixedMenu:!0,onChange:i[5]||(i[5]=n=>a.bio=n),content:a.bio,editorClass:"prose-sm py-2 px-2 min-h-[200px] border-outline-gray-2 hover:border-outline-gray-3 rounded-md bg-surface-gray-3"},null,8,["content"])])])]),_:1},8,["options"]))}},Me={class:"absolute left-1/2 mt-3 w-96 max-w-lg -translate-x-1/2 transform rounded-lg bg-surface-white px-4 sm:px-0 lg:max-w-3xl"},Re={class:"overflow-hidden rounded-lg p-3 shadow-2xl ring-1 ring-black ring-opacity-5"},Be={class:"flex items-center justify-center space-x-2"},Ne={class:""},ze={class:"relative mt-2 grid w-[25.5rem] gap-2 bg-surface-white lg:grid-cols-2"},qe=["onClick"],Ae=["src"],He={key:0,class:"mt-2 text-center text-sm text-ink-gray-4"},Oe={class:"underline",target:"_blank",href:"https://unsplash.com"},De={__name:"EditCoverImage",emits:["select"],setup(_,{emit:m}){const l=F(null),a=m,x=U({url:"lms.lms.api.get_unsplash_photos",makeParams:()=>({keyword:l.value}),auto:!0,debounce:500});I(()=>l.value,()=>{x.reload()});const g=b=>{a("select",b.file_url)},$=b=>{let t=b.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(t))return"Only image file is allowed."};return(b,t)=>(c(),P(e(te),{transition:"default"},{target:p(({isOpen:v,togglePopover:s})=>[ee(b.$slots,"default",se(ae({isOpen:v,togglePopover:s})))]),body:p(()=>[o("div",Me,[o("div",Re,[o("div",Be,[u(e(Z),{type:"text",placeholder:"search by keyword",modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=v=>l.value=v),debounce:300,class:"flex-1"},null,8,["modelValue"]),u(e(A),{fileTypes:["image/*"],validateFile:$,onSuccess:t[1]||(t[1]=v=>g(v))},{default:p(({file:v,progress:s,uploading:i,openFileSelector:n})=>[o("div",Ne,[u(e(C),{onClick:n,loading:i},{default:p(()=>[w(f(i?`Uploading ${s}%`:"Upload Image"),1)]),_:2},1032,["onClick","loading"])])]),_:1})]),o("div",ze,[(c(!0),y(H,null,Q(e(x).data,v=>(c(),y("button",{key:v.id,class:"h-[50px] w-[200px] overflow-hidden rounded hover:opacity-80",onClick:s=>b.$emit("select",v.urls.raw)},[o("img",{src:v.urls.raw+"&w=200&h=50&fit=crop&crop=entropy,faces,focalpoint"},null,8,Ae)],8,qe))),128))]),e(x).data?(c(),y("div",He,[w(f(b.__("Image search powered by"))+" ",1),o("a",Oe,f(b.__("Unsplash")),1)])):S("",!0)])])]),_:3}))}},Ge={key:1},Je={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ke={class:"group relative h-[130px] w-full"},We=["src"],Xe={key:2,class:"absolute bottom-0 left-1/2 mb-4 flex -translate-x-1/2 space-x-2 opacity-0 transition-opacity focus-within:opacity-100 group-hover:opacity-100"},Ye={class:"mx-auto -mt-10 md:-mt-4 max-w-4xl translate-x-0 px-5"},Ze={class:"flex flex-col md:flex-row items-center"},Qe=["src"],es={class:"ml-6"},ss={class:"mt-2 text-3xl font-semibold text-ink-gray-9"},as={class:"mt-2 text-base text-ink-gray-7"},ts={class:"mb-4 mt-6"},ds={__name:"Profile",props:{username:{type:String,required:!0}},setup(_){const{user:m}=ge(),l=z("$user"),a=le(),x=me(),g=F(""),$=F(!1),b=_;oe(()=>{l.data&&t.reload(),s()});const t=U({url:"frappe.client.get",makeParams(d){return{doctype:"User",filters:{username:b.username}}}}),v=U({url:"frappe.client.set_value",makeParams(d){var r;return{doctype:"User",name:(r=t.data)==null?void 0:r.name,fieldname:"cover_image",value:d.url}},onSuccess(){t.reload()}}),s=()=>{let d=a.path.split("/");["certificates","roles","slots","schedule"].forEach(k=>{d.includes(k)&&(g.value=be(k))}),g.value||(g.value="About")};re(()=>{if(g.value){let d={About:{name:"ProfileAbout"},Certificates:{name:"ProfileCertificates"},Roles:{name:"ProfileRoles"},Slots:{name:"ProfileEvaluator"},Schedule:{name:"ProfileEvaluationSchedule"}}[g.value];x.push(d)}}),I(()=>b.username,()=>{t.reload()});const i=()=>{$.value=!0},n=()=>{var d,r;return((d=l.data)==null?void 0:d.email)===((r=t.data)==null?void 0:r.email)},V=()=>{var r,k,h;let d=[{label:"About"},{label:"Certificates"}];return(r=l.data)!=null&&r.is_moderator&&d.push({label:"Roles"}),n()&&((k=l.data)!=null&&k.is_evaluator||(h=l.data)!=null&&h.is_moderator)&&(d.push({label:"Slots"}),d.push({label:"Schedule"})),d},T=B(()=>{var r,k;return[{label:"People"},{label:(r=t.data)==null?void 0:r.full_name,route:{name:"Profile",params:{username:(k=m.doc)==null?void 0:k.username}}}]}),j=B(()=>{var d,r;return{title:(d=t.data)==null?void 0:d.full_name,description:(r=t.data)==null?void 0:r.headline}});return he(j),(d,r)=>{const k=q("router-view");return c(),y(H,null,[e(l).data?e(t).data?(c(),y("div",Ge,[o("header",Je,[u(e(ie),{class:"h-7",items:T.value},null,8,["items"])]),o("div",Ke,[e(t).data.cover_image?(c(),y("img",{key:0,src:e(t).data.cover_image,class:"h-[130px] w-full object-cover object-center"},null,8,We)):(c(),y("div",{key:1,class:ne([{"bg-surface-gray-2":!e(t).data.cover_image},"h-[130px] w-full"])},null,2)),n()?(c(),y("div",Xe,[u(De,{onSelect:r[0]||(r[0]=h=>e(v).submit({url:h}))},{default:p(({togglePopover:h})=>[u(e(C),{variant:"outline",onClick:os=>h()},{prefix:p(()=>[u(e(N),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:p(()=>[w(" "+f(d.__("Edit")),1)]),_:2},1032,["onClick"])]),_:1})])):S("",!0)]),o("div",Ye,[o("div",Ze,[o("div",null,[e(t).data.user_image?(c(),y("img",{key:0,src:e(t).data.user_image,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,Qe)):(c(),P(xe,{key:1,user:e(t).data,class:"object-cover h-[100px] w-[100px] rounded-full border-4 border-white object-cover"},null,8,["user"]))]),o("div",es,[o("h2",ss,f(e(t).data.full_name),1),o("div",as,f(e(t).data.headline),1)]),n()?(c(),P(e(C),{key:0,class:"mt-3 sm:mt-0 md:ml-auto",onClick:r[1]||(r[1]=h=>i())},{prefix:p(()=>[u(e(N),{class:"w-4 h-4 stroke-1.5 text-ink-gray-7"})]),default:p(()=>[w(" "+f(d.__("Edit Profile")),1)]),_:1})):S("",!0)]),o("div",ts,[u(e(de),{class:"inline-block",buttons:V(),modelValue:g.value,"onUpdate:modelValue":r[2]||(r[2]=h=>g.value=h)},null,8,["buttons","modelValue"])]),u(k,{profile:e(t)},null,8,["profile"])])])):S("",!0):(c(),P(Pe,{key:0})),u(Le,{modelValue:$.value,"onUpdate:modelValue":r[3]||(r[3]=h=>$.value=h),reloadProfile:e(t),"onUpdate:reloadProfile":r[4]||(r[4]=h=>ue(t)?t.value=h:null),profile:e(t)},null,8,["modelValue","reloadProfile","profile"])],64)}}};export{ds as default};
//# sourceMappingURL=Profile-CBDKwGzK.js.map
