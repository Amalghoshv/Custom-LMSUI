var oe=Object.defineProperty;var D=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var L=(p,u,i)=>u in p?oe(p,u,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[u]=i,U=(p,u)=>{for(var i in u||(u={}))le.call(u,i)&&L(p,i,u[i]);if(D)for(var i of D(u))te.call(u,i)&&L(p,i,u[i]);return p};import{r as F,aT as ae,a as re,s as ie,f as ne,F as ue,j as y,a7 as de,w as ce,d as M,G as h,z as t,J as r,C as a,aG as me,v as N,H as w,y as v,I as d,K as x,P as c,a5 as k,T as pe,a9 as _e,L as be,M as fe,b3 as ge,x as f}from"./frappe-ui-2-dobwEi.js";import{a as ve,d as j,s as C,b as ye,T as he,ah as ke,q as I,a1 as Ce}from"./index-Dg_4Jaqk.js";import{_ as Ve}from"./CourseOutline-B8iPR3UL.js";import{_ as we}from"./MultiSelect-D_GctMjf.js";import"./vuedraggable.umd-xDJT7alU.js";const xe={class:""},Se={class:"grid md:grid-cols-[70%,30%] h-full"},Ue={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Ne={class:"flex items-center mt-3 md:mt-0"},Ee={class:"mt-5 mb-10"},Pe={class:"container mb-5"},Te={class:"text-lg font-semibold mb-4"},$e={class:"mb-4"},De={class:"mb-1.5 text-sm text-ink-gray-5"},Le={class:"mb-4"},Fe={class:"text-xs text-ink-gray-5 mb-2"},Me={class:"flex items-center"},je={class:"border rounded-md w-fit py-5 px-20"},Ie={class:"ml-4"},Re={class:"mt-2 text-ink-gray-5 text-sm"},Oe={key:1,class:"mb-4"},Ae={class:"flex items-center"},Be=["src"],Ke={class:"ml-4"},qe={class:"mt-2 text-ink-gray-5 text-sm"},ze={class:"mb-4"},Ge={class:"mb-1.5 text-xs text-ink-gray-5"},He={class:"flex items-center"},Je={class:"flex items-center bg-surface-gray-2 text-ink-gray-7 p-2 rounded-md mr-2"},Xe={class:"w-1/2 mb-4"},Qe={class:"container border-t"},We={class:"text-lg font-semibold mt-5 mb-4"},Ye={class:"grid grid-cols-3 gap-10 mb-4"},Ze={key:0,class:"flex flex-col space-y-4"},es={class:"flex flex-col space-y-3"},ss={class:"flex flex-col space-y-3"},os={class:"container border-t"},ls={class:"text-lg font-semibold mt-5 mb-4"},ts={class:"mb-4"},as={class:"border-l pt-5"},ps={__name:"CourseForm",props:{courseName:{type:String}},setup(p){const u=ne("$user"),i=F(""),V=ue(),g=F([]),E=ve(),R=ae(),{$dialog:O}=R.appContext.config.globalProperties,_=p,o=re({title:"",short_introduction:"",description:"",video_link:"",course_image:null,tags:"",category:"",published:!1,published_on:"",featured:!1,upcoming:!1,disable_self_learning:!1,enable_certification:!1,paid_course:!1,course_price:"",currency:""});ie(()=>{var e,s;_.courseName=="new"&&!((e=u.data)!=null&&e.is_moderator)&&!((s=u.data)!=null&&s.is_instructor)&&V.push({name:"Courses"}),_.courseName!=="new"?b.reload():j("course_form_opened"),window.addEventListener("keydown",P)});const P=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(T(),e.preventDefault())};de(()=>{window.removeEventListener("keydown",P)});const A=y({url:"frappe.client.insert",makeParams(e){var s;return{doc:U({doctype:"LMS Course",image:((s=o.course_image)==null?void 0:s.file_url)||"",instructors:g.value.map(n=>({instructor:n}))},e)}}}),B=y({url:"frappe.client.set_value",auto:!1,makeParams(e){var s;return{doctype:"LMS Course",name:e.course,fieldname:U({image:((s=o.course_image)==null?void 0:s.file_url)||"",instructors:g.value.map(n=>({instructor:n}))},o)}}}),b=y({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Course",name:_.courseName}},auto:!1,onSuccess(e){Object.keys(e).forEach(n=>{n=="instructors"?(g.value=[],e.instructors.forEach(m=>{g.value.push(m.instructor)})):Object.hasOwn(o,n)&&(o[n]=e[n])});let s=["published","upcoming","disable_self_learning","paid_course","featured","enable_certification"];for(let n in s){let m=s[n];o[m]=!!o[m]}e.image&&K.reload({image:e.image}),Y()}}),K=y({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){o.course_image=e}}),T=()=>{b.data?B.submit({course:b.data.name},{onSuccess(){C("Success","Course updated successfully","check")},onError(e){var s;C("Error",((s=e.messages)==null?void 0:s[0])||e,"x")}}):A.submit(o,{onSuccess(e){j("course_created"),C("Success","Course created successfully","check"),V.push({name:"CourseForm",params:{courseName:e.name}})},onError(e){var s;C("Error",((s=e.messages)==null?void 0:s[0])||e,"x")}})},q=y({url:"lms.lms.api.delete_course",makeParams(e){return{course:_.courseName}},onSuccess(){C(__("Success"),__("Course deleted successfully"),"check"),V.push({name:"Courses"})}}),z=()=>{O({title:__("Delete Course"),message:__("Deleting the course will also delete all its chapters and lessons. Are you sure you want to delete this course?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(e){q.submit(),e()}}]})};ce(()=>_.courseName!=="new",e=>{e&&b.reload()});const G=e=>{let s=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png","webp"].includes(s))return __("Only image file is allowed.")},H=()=>{i.value&&(o.tags=o.tags?`${o.tags}, ${i.value}`:i.value,i.value="")},J=e=>{var s;o.tags=(s=o.tags)==null?void 0:s.split(", ").filter(n=>n!==e).join(", "),i.value=""},X=e=>{o.course_image=e},Q=()=>{o.course_image=null},W=e=>{e(),E.activeTab="Categories",E.isSettingsOpen=!0},Y=()=>{var s;let e=!1;(s=u.data)!=null&&s.is_moderator||(g.value.forEach(n=>{var m;!e&&n==((m=u.data)==null?void 0:m.name)&&(e=!0)}),e||V.push({name:"Courses"}))},Z=M(()=>{let e=[{label:"Courses",route:{name:"Courses"}}];return b.data&&e.push({label:o.title,route:{name:"CourseDetail",params:{courseName:_.courseName}}}),e.push({label:_.courseName=="new"?"New Course":"Edit Course",route:{name:"CourseForm",params:{courseName:_.courseName}}}),e}),ee=M(()=>({title:"Create a Course",description:"Create or edit a course for your learning system."}));return ye(ee),(e,s)=>{var n,m,$;return f(),h("div",xe,[t("div",Se,[t("div",null,[t("header",Ue,[r(a(me),{class:"h-7",items:Z.value},null,8,["items"]),t("div",Ne,[(n=a(b).data)!=null&&n.name?(f(),N(a(x),{key:0,onClick:s[0]||(s[0]=l=>z())},{prefix:v(()=>[r(a(he),{class:"w-4 h-4 stroke-1.5"})]),default:v(()=>[t("span",null,d(e.__("Delete")),1)]),_:1})):w("",!0),r(a(x),{variant:"solid",onClick:s[1]||(s[1]=l=>T()),class:"ml-2"},{default:v(()=>[t("span",null,d(e.__("Save")),1)]),_:1})])]),t("div",Ee,[t("div",Pe,[t("div",Te,d(e.__("Details")),1),r(a(c),{modelValue:o.title,"onUpdate:modelValue":s[2]||(s[2]=l=>o.title=l),label:e.__("Title"),class:"mb-4",required:!0},null,8,["modelValue","label"]),r(a(c),{modelValue:o.short_introduction,"onUpdate:modelValue":s[3]||(s[3]=l=>o.short_introduction=l),label:e.__("Short Introduction"),placeholder:e.__("A one line introduction to the course that appears on the course card"),class:"mb-4",required:!0},null,8,["modelValue","label","placeholder"]),t("div",$e,[t("div",De,[k(d(e.__("Course Description"))+" ",1),s[21]||(s[21]=t("span",{class:"text-ink-red-3"},"*",-1))]),r(a(pe),{content:o.description,onChange:s[4]||(s[4]=l=>o.description=l),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),t("div",Le,[t("div",Fe,[k(d(e.__("Course Image"))+" ",1),s[22]||(s[22]=t("span",{class:"text-ink-red-3"},"*",-1))]),o.course_image?(f(),h("div",Oe,[t("div",Ae,[t("img",{src:o.course_image.file_url,class:"border rounded-md w-40"},null,8,Be),t("div",Ke,[r(a(x),{onClick:s[6]||(s[6]=l=>Q())},{default:v(()=>[k(d(e.__("Remove")),1)]),_:1}),t("div",qe,d(e.__("Appears on the course card in the course list")),1)])])])):(f(),N(a(_e),{key:0,fileTypes:["image/*"],validateFile:G,onSuccess:s[5]||(s[5]=l=>X(l))},{default:v(({file:l,progress:S,uploading:rs,openFileSelector:se})=>[t("div",Me,[t("div",je,[r(a(ke),{class:"size-5 stroke-1 text-ink-gray-7"})]),t("div",Ie,[r(a(x),{onClick:se},{default:v(()=>[k(d(e.__("Upload")),1)]),_:2},1032,["onClick"]),t("div",Re,d(e.__("Appears on the course card in the course list")),1)])])]),_:1}))]),r(a(c),{modelValue:o.video_link,"onUpdate:modelValue":s[7]||(s[7]=l=>o.video_link=l),label:e.__("Preview Video"),placeholder:e.__("Paste the youtube link of a short video introducing the course"),class:"mb-4"},null,8,["modelValue","label","placeholder"]),t("div",ze,[t("div",Ge,d(e.__("Tags")),1),t("div",He,[o.tags?(f(!0),h(be,{key:0},fe((m=o.tags)==null?void 0:m.split(", "),l=>(f(),h("div",Je,[k(d(l)+" ",1),r(a(Ce),{class:"stroke-1.5 w-3 h-3 ml-2 cursor-pointer",onClick:S=>J(l)},null,8,["onClick"])]))),256)):w("",!0),r(a(c),{modelValue:i.value,"onUpdate:modelValue":s[8]||(s[8]=l=>i.value=l),placeholder:e.__("Add a keyword and then press enter"),class:"w-72",onKeyup:s[9]||(s[9]=ge(l=>H(),["enter"])),id:"tags"},null,8,["modelValue","placeholder"])])]),t("div",Xe,[r(I,{doctype:"LMS Category",modelValue:o.category,"onUpdate:modelValue":s[10]||(s[10]=l=>o.category=l),label:e.__("Category"),onCreate:(l,S)=>W(S)},null,8,["modelValue","label","onCreate"])]),r(we,{modelValue:g.value,"onUpdate:modelValue":s[11]||(s[11]=l=>g.value=l),doctype:"User",label:e.__("Instructors"),filters:{ignore_user_type:1},required:!0},null,8,["modelValue","label"])]),t("div",Qe,[t("div",We,d(e.__("Settings")),1),t("div",Ye,[($=a(u).data)!=null&&$.is_moderator?(f(),h("div",Ze,[r(a(c),{type:"checkbox",modelValue:o.published,"onUpdate:modelValue":s[12]||(s[12]=l=>o.published=l),label:e.__("Published")},null,8,["modelValue","label"]),r(a(c),{modelValue:o.published_on,"onUpdate:modelValue":s[13]||(s[13]=l=>o.published_on=l),label:e.__("Published On"),type:"date",class:"mb-5"},null,8,["modelValue","label"])])):w("",!0),t("div",es,[r(a(c),{type:"checkbox",modelValue:o.upcoming,"onUpdate:modelValue":s[14]||(s[14]=l=>o.upcoming=l),label:e.__("Upcoming")},null,8,["modelValue","label"]),r(a(c),{type:"checkbox",modelValue:o.featured,"onUpdate:modelValue":s[15]||(s[15]=l=>o.featured=l),label:e.__("Featured")},null,8,["modelValue","label"])]),t("div",ss,[r(a(c),{type:"checkbox",modelValue:o.disable_self_learning,"onUpdate:modelValue":s[16]||(s[16]=l=>o.disable_self_learning=l),label:e.__("Disable Self Enrollment")},null,8,["modelValue","label"]),r(a(c),{type:"checkbox",modelValue:o.enable_certification,"onUpdate:modelValue":s[17]||(s[17]=l=>o.enable_certification=l),label:e.__("Completion Certificate")},null,8,["modelValue","label"])])])]),t("div",os,[t("div",ls,d(e.__("Pricing")),1),t("div",ts,[r(a(c),{type:"checkbox",modelValue:o.paid_course,"onUpdate:modelValue":s[18]||(s[18]=l=>o.paid_course=l),label:e.__("Paid Course")},null,8,["modelValue","label"])]),r(a(c),{modelValue:o.course_price,"onUpdate:modelValue":s[19]||(s[19]=l=>o.course_price=l),label:e.__("Course Price"),class:"mb-4"},null,8,["modelValue","label"]),r(I,{doctype:"Currency",modelValue:o.currency,"onUpdate:modelValue":s[20]||(s[20]=l=>o.currency=l),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])])])]),t("div",as,[a(b).data?(f(),N(Ve,{key:0,courseName:a(b).data.name,title:o.title,allowEdit:!0},null,8,["courseName","title"])):w("",!0)])])])}}};export{ps as default};
//# sourceMappingURL=CourseForm-CGtw0yOF.js.map
