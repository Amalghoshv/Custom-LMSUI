var Q=Object.defineProperty;var $=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var q=(u,n,a)=>n in u?Q(u,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[n]=a,z=(u,n)=>{for(var a in n||(n={}))Y.call(n,a)&&q(u,a,n[a]);if($)for(var a of $(n))K.call(n,a)&&q(u,a,n[a]);return u};import{aq as D,ar as G,d as k,v as W,x as S,y as M,z as o,J as m,C as v,q as X,r as b,G as T,I as p,L as Z,s as ee,f as se,a as te,j as w,a7 as oe,aG as re,a5 as ne,K as ae,P as E,N as le,B as ie,O as ue}from"./frappe-ui-2-dobwEi.js";import{A as de}from"./editorjs-DiZ70o4m.js";import{al as ce,I as N,a as pe,d as I,g as me,e as fe,b as he,i as ve}from"./index-Dg_4Jaqk.js";const ye={__name:"ExplanationVideos",props:D({type:{type:[String,null],required:!0},title:{type:[String,null],required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const n=G(u,"modelValue"),a=u,y=k(()=>{if(a.type=="youtube")return"/assets/lms/frontend/Youtube.mp4";if(a.type=="quiz")return"/assets/lms/frontend/Quiz.mp4";if(a.type=="upload")return"/assets/lms/frontend/Upload.mp4"});return(f,h)=>(S(),W(v(X),{modelValue:n.value,"onUpdate:modelValue":h[0]||(h[0]=i=>n.value=i),options:{size:"4xl",title:u.title}},{"body-content":M(()=>[o("div",null,[m(ce,{file:y.value},null,8,["file"])])]),_:1},8,["modelValue","options"]))}},_e={class:"space-y-5 text-ink-gray-9"},be={class:"space-y-2"},ge={class:"flex items-center text-sm font-medium space-x-2"},we={class:"text-xs text-ink-gray-5 mb-1 leading-5"},xe={class:"space-y-2"},Ne={class:"text-xs text-ink-gray-5 mb-1 leading-5"},ke={class:"space-y-2"},Se={class:"leading-5"},Ce={class:"text-xs text-ink-gray-5 mb-1 leading-5"},Le={class:"space-y-2"},Ve={class:"text-xs text-ink-gray-5 mb-1 leading-5"},$e={__name:"LessonHelp",setup(u){const n=b(!1),a=b(null),y=b(null),f={quiz:"How to add a Quiz?",upload:"How to upload content from your system?",youtube:"How to add a YouTube Video?"},h=i=>{a.value=i,y.value=f[i],n.value=!0};return(i,l)=>(S(),T(Z,null,[o("div",_e,[o("div",be,[o("div",ge,[o("span",null,p(i.__("What does include in preview mean?")),1)]),o("div",we,p(i.__("If Include in Preview is enabled for a lesson then the lesson will also be accessible to non logged in users.")),1)]),o("div",xe,[o("div",{class:"flex items-center text-sm font-medium space-x-2 cursor-pointer",onClick:l[0]||(l[0]=_=>h("quiz"))},[o("span",null,p(i.__("How to add a Quiz?")),1),m(v(N),{class:"w-3 h-3 text-ink-gray-7"})]),o("div",Ne,p(i.__("Click on the add icon in the editor and select Quiz from the menu. It opens up a dialog, where you can either select a quiz from the list or create a new quiz. When you select the Create New option it redirects you to the quiz creation page.")),1)]),o("div",ke,[o("div",{class:"flex text-sm font-medium space-x-2 cursor-pointer",onClick:l[1]||(l[1]=_=>h("upload"))},[o("span",Se,p(i.__(f.upload)),1),m(v(N),{class:"w-3 h-3 text-ink-gray-7"})]),o("div",Ce,p(i.__("To upload Image, Video, Audio or PDF from your system, click on the add icon and select upload from the menu. Then choose the file you want to add to the lesson and it gets added to your lesson.")),1)]),o("div",Le,[o("div",{class:"flex items-center text-sm font-medium space-x-2 cursor-pointer",onClick:l[2]||(l[2]=_=>h("youtube"))},[o("span",null,p(i.__(f.youtube)),1),m(v(N),{class:"w-3 h-3 text-ink-gray-7"})]),o("div",Ve,p(i.__("Copy the URL of the video from YouTube and paste it in the editor.")),1)])]),m(ye,{modelValue:n.value,"onUpdate:modelValue":l[3]||(l[3]=_=>n.value=_),title:y.value,type:a.value},null,8,["modelValue","title","type"])],64))}},qe={class:""},ze={class:"grid md:grid-cols-[75%,25%] h-screen"},Ee={class:"border-r"},Ie={class:"sticky top-0 z-10 flex flex-col md:flex-row md:items-center justify-between border-b overflow-hidden bg-surface-white px-3 py-2.5 sm:px-5"},Me={class:"py-5"},Te={class:"w-5/6 mx-auto"},Pe={class:"border-t mt-4"},Be={class:"w-5/6 mx-auto pt-4"},Re={class:"block font-medium text-ink-gray-5 mb-1"},Oe={id:"instructor-notes",class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal py-3"},Ue={class:"border-t mt-4"},Fe={class:"w-5/6 mx-auto pt-4"},He={class:"block font-medium text-ink-gray-5 mb-1"},Je={class:""},je={class:"sticky top-0 p-5"},De={__name:"LessonForm",props:{courseName:{type:String,required:!0},chapterNumber:{type:String,required:!0},lessonNumber:{type:String,required:!0}},setup(u){const n=b(null),a=b(null),y=se("$user"),f=b(!1);pe();let h,i=!1;const l=u;ee(()=>{var e,s;!((e=y.data)!=null&&e.is_moderator)&&!((s=y.data)!=null&&s.is_instructor)&&(window.location.href="/login"),I("lesson_form_opened"),n.value=_("content"),a.value=_("instructor-notes"),window.addEventListener("keydown",C)});const _=e=>new de({holder:e,tools:me(),autofocus:!0,defaultBlock:"markdown"}),c=te({title:"",include_in_preview:!1,body:"Test",instructor_notes:"",content:""}),d=w({url:"lms.lms.utils.get_lesson_creation_details",params:{course:l.courseName,chapter:l.chapterNumber,lesson:l.lessonNumber},auto:!0,onSuccess(e){var s;e.lesson&&(Object.keys(e.lesson).forEach(t=>{c[t]=e.lesson[t]}),c.include_in_preview=!!((s=e==null?void 0:e.lesson)!=null&&s.include_in_preview),P(e),B(e),R())}}),P=e=>{n.value.isReady.then(()=>{if(e.lesson.content)n.value.render(JSON.parse(e.lesson.content));else if(e.lesson.body){let s=L(e.lesson);n.value.render({blocks:s})}})},B=e=>{a.value.isReady.then(()=>{if(e.lesson.instructor_content)a.value.render(JSON.parse(e.lesson.instructor_content));else if(e.lesson.instructor_notes){let s=L(e.lesson);a.value.render({blocks:s})}})},R=()=>{h=setInterval(()=>{x({showSuccessMessage:!1})},1e4)},C=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(x({showSuccessMessage:!0}),e.preventDefault())};oe(()=>{clearInterval(h),window.removeEventListener("keydown",C)});const O=w({url:"frappe.client.insert",makeParams(e){var s;return{doc:z({doctype:"Course Lesson",course:l.courseName,chapter:(s=d.data)==null?void 0:s.chapter.name},c)}}}),U=w({url:"frappe.client.set_value",makeParams(e){return{doctype:"Course Lesson",name:e.lesson,fieldname:c}}}),F=w({url:"frappe.client.insert",makeParams(e){var s;return{doc:{doctype:"Lesson Reference",parent:(s=d.data)==null?void 0:s.chapter.name,parenttype:"Course Chapter",parentfield:"lessons",lesson:e.lesson,idx:l.lessonNumber}}}}),L=e=>{let s=[];if(e.youtube){let t=e.youtube.split("/").pop();s.push({type:"embed",data:{service:"youtube",embed:`https://www.youtube.com/embed/${t}`}})}return e.body.split(`
`).forEach(t=>{if(t.includes("{{ YouTubeVideo")){let r=t.match(/\(["']([^"']+?)["']\)/)[1];r.includes("https://")||(r=`https://www.youtube.com/embed/${r}`),s.push({type:"embed",data:{service:"youtube",embed:r}})}else if(t.includes("{{ Quiz")){let r=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"quiz",data:{quiz:r}})}else if(t.includes("{{ Video")){let r=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"upload",data:{file_url:r,file_type:"video"}})}else if(t.includes("{{ Audio")){let r=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"upload",data:{file_url:r,file_type:"audio"}})}else if(t.includes("{{ PDF")){let r=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"upload",data:{file_url:r,file_type:"pdf"}})}else if(t.includes("{{ Embed")){let r=t.match(/\(["']([^"']+?)["']\)/)[1];s.push({type:"embed",data:{service:r.split("|||")[0],embed:r.split("|||")[1]}})}else if(t.includes("![]")){let r=t.match(/\((.*?)\)/)[1];s.push({type:"upload",data:{file_url:r,file_type:"image"}})}else if(t.includes("#")){let r=(t.match(/#/g)||[]).length;s.push({type:"header",data:{text:t.replace(/#/g,"").trim(),level:r}})}else s.push({type:"paragraph",data:{text:t}})}),e.quizId&&s.push({type:"quiz",data:{quiz:e.quizId}}),s},x=e=>{i=!1,typeof e!="undefined"&&e.showSuccessMessage&&(i=!0),n.value.save().then(s=>{c.content=JSON.stringify(s),a.value.save().then(t=>{var r;c.instructor_content=JSON.stringify(t),(r=d.data)!=null&&r.lesson?J():H()})})},H=()=>{O.submit({},{validate(){return V()},onSuccess(e){F.submit({lesson:e.name},{onSuccess(){I("lesson_created"),g("Success","Lesson created successfully","check"),d.reload()}})},onError(e){g("Error",e.message,"x")}})},J=()=>{U.submit({lesson:d.data.lesson.name},{validate(){return V()},onSuccess(){i&&g("Success","Lesson updated successfully","check")},onError(e){g("Error",e.message,"x")}})},V=()=>{if(!c.title)return"Title is required";if(!c.content)return"Content is required"},g=(e,s,t)=>{fe({title:e,text:s,icon:t,iconClasses:t=="check"?"bg-surface-green-3 text-ink-white rounded-md p-px":"bg-surface-red-5 text-ink-white rounded-md p-px",position:t=="check"?"bottom-right":"top-center",timeout:t=="check"?5:10})},j=k(()=>{var s,t,r;let e=[{label:"Courses",route:{name:"Courses"}},{label:(s=d.data)==null?void 0:s.course_title,route:{name:"CourseForm",params:{courseName:l.courseName}}}];return(t=d==null?void 0:d.data)!=null&&t.lesson&&e.push({label:d.data.lesson.title,route:{name:"Lesson",params:{courseName:l.courseName,chapterNumber:l.chapterNumber,lessonNumber:l.lessonNumber}}}),e.push({label:(r=d==null?void 0:d.data)!=null&&r.lesson?"Edit Lesson":"Create Lesson",route:{name:"LessonForm",params:{courseName:l.courseName,chapterNumber:l.chapterNumber,lessonNumber:l.lessonNumber}}}),e}),A=k(()=>({title:"Lesson Editor",description:"Create and edit lessons for your course"}));return he(A),(e,s)=>(S(),T("div",qe,[o("div",ze,[o("div",Ee,[o("header",Ie,[m(v(re),{class:"text-ellipsis",items:j.value},null,8,["items"]),m(v(ae),{variant:"solid",onClick:s[0]||(s[0]=t=>x({showSuccessMessage:!0})),class:"mt-3 md:mt-0"},{default:M(()=>[ne(p(e.__("Save")),1)]),_:1})]),o("div",Me,[o("div",Te,[m(v(E),{modelValue:c.title,"onUpdate:modelValue":s[1]||(s[1]=t=>c.title=t),label:"Title",class:"mb-4",required:!0},null,8,["modelValue"]),m(v(E),{modelValue:c.include_in_preview,"onUpdate:modelValue":s[2]||(s[2]=t=>c.include_in_preview=t),type:"checkbox",label:"Include in Preview"},null,8,["modelValue"])]),o("div",Pe,[o("div",Be,[o("div",{class:"flex justify-between cursor-pointer",onClick:s[3]||(s[3]=()=>{f.value=!f.value})},[o("label",Re,p(e.__("Instructor Notes")),1),m(v(ve),{class:ie(["stroke-2 h-5 w-5 text-ink-gray-5",{"rotate-90 transform duration-200":f.value,"duration-200":!f.value}])},null,8,["class"])]),le(o("div",Oe,null,512),[[ue,f.value]])])]),o("div",Ue,[o("div",Fe,[o("label",He,p(e.__("Content")),1),s[4]||(s[4]=o("div",{id:"content",class:"ProseMirror prose prose-table:table-fixed prose-td:p-2 prose-th:p-2 prose-td:border prose-th:border prose-td:border-outline-gray-2 prose-th:border-outline-gray-2 prose-td:relative prose-th:relative prose-th:bg-surface-gray-2 prose-sm max-w-none !whitespace-normal py-3"},null,-1))])])])]),o("div",Je,[o("div",je,[m($e)])])])]))}};export{De as default};
//# sourceMappingURL=LessonForm-Ccp6Yvuk.js.map
