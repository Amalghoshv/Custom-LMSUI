var I=Object.defineProperty;var S=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var N=(c,d,r)=>d in c?I(c,d,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[d]=r,v=(c,d)=>{for(var r in d||(d={}))F.call(d,r)&&N(c,r,d[r]);if(S)for(var r of S(d))R.call(d,r)&&N(c,r,d[r]);return c};import{a as A,r as K,s as G,f as J,j as f,a7 as H,F as Q,d as W,G as E,z as s,J as o,C as n,aG as X,y as h,a5 as g,I as u,K as y,P as i,v as Y,a9 as Z,T as ee,x as V}from"./frappe-ui-2-dobwEi.js";import{d as x,s as C,ah as le,q as D}from"./index-Dg_4Jaqk.js";import{_ as ae}from"./MultiSelect-D_GctMjf.js";const te={class:""},se={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},oe={class:"w-1/2 mx-auto py-5"},ne={class:""},ie={class:"text-lg font-semibold mb-4"},de={class:"grid grid-cols-2 gap-10 mb-4 space-y-2"},re={class:"flex flex-col space-y-2"},me={class:"mb-4"},ue={class:"text-xs text-ink-gray-5 mb-2"},ce={class:"flex items-center"},pe={class:"border rounded-md w-fit py-5 px-20"},be={class:"ml-4"},_e={class:"mt-2 text-ink-gray-5 text-sm"},fe={key:1,class:"mb-4"},he={class:"flex items-center"},ge=["src"],ve={class:"ml-4"},ye={class:"mt-2 text-ink-gray-5 text-sm"},Ve={class:"mb-4"},we={class:"block text-sm text-ink-gray-5 mb-1"},ke={class:"mb-4"},Be={class:"text-lg font-semibold mb-4"},Ue={class:"grid grid-cols-2 gap-10"},Se={class:"mb-4"},Ne={class:"text-lg font-semibold mb-4"},Ee={class:"grid grid-cols-2 gap-10"},xe={class:""},Ce={class:"text-lg font-semibold mb-4"},$e={__name:"BatchForm",props:{batchName:{type:String,required:!0}},setup(c){const d=Q(),r=J("$user"),p=c,t=A({title:"",published:!1,description:"",batch_details:"",start_date:"",end_date:"",start_time:"",end_time:"",timezone:"",evaluation_end_date:"",seat_count:"",medium:"",category:"",allow_self_enrollment:!1,image:null,paid_batch:!1,currency:"",amount:0}),b=K([]);G(()=>{r.data||(window.location.href="/login"),p.batchName!="new"?_.reload():x("batch_form_opened"),window.addEventListener("keydown",w)});const w=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&!e.target.classList.contains("ProseMirror")&&(k(),e.preventDefault())};H(()=>{window.removeEventListener("keydown",w)});const T=f({url:"frappe.client.insert",makeParams(e){var l;return{doc:v({doctype:"LMS Batch",meta_image:(l=t.image)==null?void 0:l.file_url,instructors:b.value.map(a=>({instructor:a}))},t)}}}),_=f({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Batch",name:p.batchName}},onSuccess(e){Object.keys(e).forEach(a=>{if(a=="instructors")e.instructors.forEach(m=>{b.value.push(m.instructor)});else if(["start_time","end_time"].includes(a)){let[m,B,U]=e[a].split(":");m=m.length==1?"0"+m:m,t[a]=`${m}:${B}`}else Object.hasOwn(t,a)&&(t[a]=e[a])});let l=["published","paid_batch","allow_self_enrollment"];for(let a in l){let m=l[a];t[m]=!!t[m]}e.meta_image&&L.reload({image:e.meta_image})}}),q=f({url:"frappe.client.set_value",makeParams(e){var l;return{doctype:"LMS Batch",name:p.batchName,fieldname:v({meta_image:(l=t.image)==null?void 0:l.file_url,instructors:b.value.map(a=>({instructor:a}))},t)}}}),L=f({url:"lms.lms.api.get_file_info",makeParams(e){return{file_url:e.image}},auto:!1,onSuccess(e){t.image=e}}),k=()=>{_.data?M():$()},$=()=>{T.submit({},{onSuccess(e){x("batch_created"),d.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var l;C("Error",((l=e.messages)==null?void 0:l[0])||e,"x")}})},M=()=>{q.submit({},{onSuccess(e){d.push({name:"BatchDetail",params:{batchName:e.name}})},onError(e){var l;C("Error",((l=e.messages)==null?void 0:l[0])||e,"x")}})},P=e=>{t.image=e},O=()=>{t.image=null},j=e=>{let l=e.name.split(".").pop().toLowerCase();if(!["jpg","jpeg","png"].includes(l))return"Only image file is allowed."},z=W(()=>{let e=[{label:"Batches",route:{name:"Batches"}}];return _.data&&e.push({label:_.data.title,route:{name:"BatchDetail",params:{batchName:p.batchName}}}),e.push({label:p.batchName=="new"?"New Batch":"Edit Batch",route:{name:"BatchForm",params:{batchName:p.batchName}}}),e});return(e,l)=>(V(),E("div",te,[s("header",se,[o(n(X),{class:"h-7",items:z.value},null,8,["items"]),o(n(y),{variant:"solid",onClick:l[0]||(l[0]=a=>k())},{default:h(()=>[g(u(e.__("Save")),1)]),_:1})]),s("div",oe,[s("div",ne,[s("div",ie,u(e.__("Details")),1),s("div",de,[s("div",null,[o(n(i),{modelValue:t.title,"onUpdate:modelValue":l[1]||(l[1]=a=>t.title=a),label:e.__("Title"),required:!0},null,8,["modelValue","label"])]),s("div",re,[o(n(i),{modelValue:t.published,"onUpdate:modelValue":l[2]||(l[2]=a=>t.published=a),type:"checkbox",label:e.__("Published")},null,8,["modelValue","label"]),o(n(i),{modelValue:t.allow_self_enrollment,"onUpdate:modelValue":l[3]||(l[3]=a=>t.allow_self_enrollment=a),type:"checkbox",label:e.__("Allow self enrollment")},null,8,["modelValue","label"])])])]),s("div",me,[s("div",ue,u(e.__("Meta Image")),1),t.image?(V(),E("div",fe,[s("div",he,[s("img",{src:t.image.file_url,class:"border rounded-md w-40"},null,8,ge),s("div",ve,[o(n(y),{onClick:l[5]||(l[5]=a=>O())},{default:h(()=>[g(u(e.__("Remove")),1)]),_:1}),s("div",ye,u(e.__("Appears when the batch URL is shared on any online platform")),1)])])])):(V(),Y(n(Z),{key:0,fileTypes:["image/*"],validateFile:j,onSuccess:l[4]||(l[4]=a=>P(a))},{default:h(({file:a,progress:m,uploading:B,openFileSelector:U})=>[s("div",ce,[s("div",pe,[o(n(le),{class:"size-5 stroke-1 text-ink-gray-7"})]),s("div",be,[o(n(y),{onClick:U},{default:h(()=>[g(u(e.__("Upload")),1)]),_:2},1032,["onClick"]),s("div",_e,u(e.__("Appears when the batch URL is shared on any online platform")),1)])])]),_:1}))]),o(ae,{modelValue:b.value,"onUpdate:modelValue":l[6]||(l[6]=a=>b.value=a),doctype:"User",label:e.__("Instructors"),required:!0,filters:{ignore_user_type:1}},null,8,["modelValue","label"]),s("div",Ve,[o(n(i),{modelValue:t.description,"onUpdate:modelValue":l[7]||(l[7]=a=>t.description=a),label:e.__("Description"),type:"textarea",class:"my-4",placeholder:e.__("Short description of the batch"),required:!0},null,8,["modelValue","label","placeholder"]),s("div",null,[s("label",we,[g(u(e.__("Batch Details"))+" ",1),l[21]||(l[21]=s("span",{class:"text-ink-red-3"},"*",-1))]),o(n(ee),{content:t.batch_details,onChange:l[8]||(l[8]=a=>t.batch_details=a),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem] mb-4"},null,8,["content"])])]),s("div",ke,[s("div",Be,u(e.__("Date and Time")),1),s("div",Ue,[s("div",null,[o(n(i),{modelValue:t.start_date,"onUpdate:modelValue":l[9]||(l[9]=a=>t.start_date=a),label:e.__("Start Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(n(i),{modelValue:t.end_date,"onUpdate:modelValue":l[10]||(l[10]=a=>t.end_date=a),label:e.__("End Date"),type:"date",class:"mb-4",required:!0},null,8,["modelValue","label"])]),s("div",null,[o(n(i),{modelValue:t.start_time,"onUpdate:modelValue":l[11]||(l[11]=a=>t.start_time=a),label:e.__("Start Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(n(i),{modelValue:t.end_time,"onUpdate:modelValue":l[12]||(l[12]=a=>t.end_time=a),label:e.__("End Time"),type:"time",class:"mb-4",required:!0},null,8,["modelValue","label"]),o(n(i),{modelValue:t.timezone,"onUpdate:modelValue":l[13]||(l[13]=a=>t.timezone=a),label:e.__("Timezone"),type:"text",placeholder:e.__("Example: IST (+5:30)"),class:"mb-4",required:!0},null,8,["modelValue","label","placeholder"])])])]),s("div",Se,[s("div",Ne,u(e.__("Settings")),1),s("div",Ee,[s("div",null,[o(n(i),{modelValue:t.seat_count,"onUpdate:modelValue":l[14]||(l[14]=a=>t.seat_count=a),label:e.__("Seat Count"),type:"number",class:"mb-4",placeholder:e.__("Number of seats available")},null,8,["modelValue","label","placeholder"]),o(n(i),{modelValue:t.evaluation_end_date,"onUpdate:modelValue":l[15]||(l[15]=a=>t.evaluation_end_date=a),label:e.__("Evaluation End Date"),type:"date",class:"mb-4"},null,8,["modelValue","label"])]),s("div",null,[o(n(i),{modelValue:t.medium,"onUpdate:modelValue":l[16]||(l[16]=a=>t.medium=a),type:"select",options:[{label:"Online",value:"Online"},{label:"Offline",value:"Offline"}],label:e.__("Medium"),class:"mb-4"},null,8,["modelValue","label"]),o(D,{doctype:"LMS Category",label:e.__("Category"),modelValue:t.category,"onUpdate:modelValue":l[17]||(l[17]=a=>t.category=a)},null,8,["label","modelValue"])])])]),s("div",xe,[s("div",Ce,u(e.__("Payment")),1),s("div",null,[o(n(i),{modelValue:t.paid_batch,"onUpdate:modelValue":l[18]||(l[18]=a=>t.paid_batch=a),type:"checkbox",label:e.__("Paid Batch")},null,8,["modelValue","label"]),o(n(i),{modelValue:t.amount,"onUpdate:modelValue":l[19]||(l[19]=a=>t.amount=a),label:e.__("Amount"),type:"number",class:"my-4"},null,8,["modelValue","label"]),o(D,{doctype:"Currency",modelValue:t.currency,"onUpdate:modelValue":l[20]||(l[20]=a=>t.currency=a),filters:{enabled:1},label:e.__("Currency")},null,8,["modelValue","label"])])])])]))}};export{$e as default};
//# sourceMappingURL=BatchForm-ayc4drVD.js.map
