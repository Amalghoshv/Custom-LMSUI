import{G as p,x as m,z as l,a5 as v,I as r,J as i,y as C,C as n,K as x,s as N,f as U,j as f,a as A,H as y,aG as T,P as u,v as V}from"./frappe-ui-2-dobwEi.js";import{q as w,s as z}from"./index-Dg_4Jaqk.js";const E={class:"text-base border rounded-md w-1/3 mx-auto my-32"},G={class:"border-b px-5 py-3 font-medium"},I={class:"px-5 py-3"},D={class:"mb-4 leading-6"},P={__name:"NotPermitted",props:{title:{type:String,default:"Not Permitted"},text:{type:String,default:"You are not permitted to access this page."},buttonLabel:{type:String,default:"Login"},buttonLink:{type:String,default:"/login"}},setup(d){const g=d,c=()=>{window.location.href=g.buttonLink};return(_,a)=>(m(),p("div",E,[l("div",G,[a[1]||(a[1]=l("span",{class:"inline-flex items-center before:bg-surface-red-5 before:w-2 before:h-2 before:rounded-md before:mr-2"},null,-1)),v(" "+r(_.__(d.title)),1)]),l("div",I,[l("div",D,r(_.__(d.text)),1),i(n(x),{variant:"solid",class:"w-full",onClick:a[0]||(a[0]=t=>c())},{default:C(()=>[v(r(_.__(d.buttonLabel)),1)]),_:1})])]))}},q={class:""},H={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},K={key:0,class:"pt-5 pb-10 mx-5"},O={class:"flex flex-col lg:flex-row justify-between"},J={class:"h-fit bg-surface-gray-2 rounded-md p-5 space-y-4 lg:order-last mb-10 lg:mt-10 text-sm font-medium lg:w-1/4"},R={class:"flex items-center justify-between space-x-2"},W={class:"text-ink-gray-5"},F={class:""},Y={key:0,class:"flex items-center justify-between"},Q={class:"text-ink-gray-5"},X={class:""},Z={key:1,class:"flex items-center justify-between mt-2"},ee={class:"text-ink-gray-5"},te={class:"flex items-center justify-between border-t border-outline-gray-3 pt-4 mt-2"},se={class:"text-lg font-semibold"},le={class:"text-lg font-semibold"},ne={class:"flex-1 lg:mr-10"},oe={class:"mb-5"},ae={class:"text-lg font-semibold"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-5"},re={class:"space-y-4"},de={class:"space-y-4"},ue={class:"flex items-center justify-between border-t pt-4 mt-8"},me={class:"text-ink-gray-5"},ce={key:1},_e={key:2},ye={__name:"Billing",props:{type:{type:String,required:!0},name:{type:String,required:!0}},setup(d){const g=U("$user");N(()=>{var s;const e=document.createElement("script");e.src="https://checkout.razorpay.com/v1/checkout.js",document.body.appendChild(e),(s=g.data)!=null&&s.name&&_.submit()});const c=d,_=f({url:"lms.lms.api.validate_billing_access",params:{type:c.type,name:c.name},onSuccess(e){L(e.address),a.submit()}}),a=f({url:"lms.lms.utils.get_order_summary",makeParams(e){return{doctype:c.type=="course"?"LMS Course":"LMS Batch",docname:c.name,country:t.country}},onError(e){j(e)}}),t=A({}),L=e=>{t.billing_name=(e==null?void 0:e.billing_name)||"",t.address_line1=(e==null?void 0:e.address_line1)||"",t.address_line2=(e==null?void 0:e.address_line2)||"",t.city=(e==null?void 0:e.city)||"",t.state=(e==null?void 0:e.state)||"",t.country=(e==null?void 0:e.country)||"",t.pincode=(e==null?void 0:e.pincode)||"",t.phone=(e==null?void 0:e.phone)||"",t.source=(e==null?void 0:e.source)||"",t.gstin=(e==null?void 0:e.gstin)||"",t.pan=(e==null?void 0:e.pan)||""},S=f({url:"lms.lms.payments.get_payment_link",makeParams(e){return{doctype:c.type=="course"?"LMS Course":"LMS Batch",docname:c.name,title:a.data.title,amount:a.data.original_amount,total_amount:a.data.amount,currency:a.data.currency,address:t}}}),B=()=>{S.submit({},{validate(){return t.source?$():__("Please let us know where you heard about us from.")},onSuccess(e){window.location.href=e},onError(e){var s;z(__("Error"),((s=e.messages)==null?void 0:s[0])||e,"x")}})},$=()=>{let e=["billing_name","address_line1","city","pincode","country","phone","source"];for(let b of e)if(!t[b])return"Please enter a valid "+b.replaceAll("_"," ").toLowerCase().replace(/\b\w/g,h=>h.toUpperCase());if(t.gstin&&!t.pan)return"Please enter a valid pan number.";if(t.country=="India"&&!t.state)return"Please enter a valid state with correct spelling and the first letter capitalized.";const s=["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Delhi","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal"];if(t.country=="India"&&!s.includes(t.state))return"Please enter a valid state with correct spelling and the first letter capitalized."},j=e=>{var s;createToast({title:"Error",text:((s=e.messages)==null?void 0:s[0])||e,icon:"x",iconClasses:"bg-surface-red-5 text-ink-white rounded-md p-px",position:"top-center",timeout:10})},M=e=>{t.country=e,a.reload()};return(e,s)=>{var b,h,k;return m(),p("div",q,[l("header",H,[i(n(T),{class:"h-7",items:[{label:e.__("Billing Details"),route:{name:"Billing"}}]},null,8,["items"])]),(b=n(_).data)!=null&&b.access&&n(a).data?(m(),p("div",K,[l("div",O,[l("div",J,[l("div",R,[l("div",W,r(e.__("Ordered Item")),1),l("div",F,r(n(a).data.title),1)]),n(a).data.gst_applied?(m(),p("div",Y,[l("div",Q,r(e.__("Original Amount")),1),l("div",X,r(n(a).data.original_amount_formatted),1)])):y("",!0),n(a).data.gst_applied?(m(),p("div",Z,[l("div",ee,r(e.__("GST Amount")),1),l("div",null,r(n(a).data.gst_amount_formatted),1)])):y("",!0),l("div",te,[l("div",se,r(e.__("Total")),1),l("div",le,r(n(a).data.total_amount_formatted),1)])]),l("div",ne,[l("div",oe,[l("div",ae,r(e.__("Address")),1)]),l("div",ie,[l("div",re,[i(n(u),{label:e.__("Billing Name"),modelValue:t.billing_name,"onUpdate:modelValue":s[0]||(s[0]=o=>t.billing_name=o)},null,8,["label","modelValue"]),i(n(u),{label:e.__("Address Line 1"),modelValue:t.address_line1,"onUpdate:modelValue":s[1]||(s[1]=o=>t.address_line1=o)},null,8,["label","modelValue"]),i(n(u),{label:e.__("Address Line 2"),modelValue:t.address_line2,"onUpdate:modelValue":s[2]||(s[2]=o=>t.address_line2=o)},null,8,["label","modelValue"]),i(n(u),{label:e.__("City"),modelValue:t.city,"onUpdate:modelValue":s[3]||(s[3]=o=>t.city=o)},null,8,["label","modelValue"]),i(n(u),{label:e.__("State"),modelValue:t.state,"onUpdate:modelValue":s[4]||(s[4]=o=>t.state=o)},null,8,["label","modelValue"])]),l("div",de,[i(w,{doctype:"Country",value:t.country,onChange:s[5]||(s[5]=o=>M(o)),label:e.__("Country")},null,8,["value","label"]),i(n(u),{label:e.__("Postal Code"),modelValue:t.pincode,"onUpdate:modelValue":s[6]||(s[6]=o=>t.pincode=o)},null,8,["label","modelValue"]),i(n(u),{label:e.__("Phone Number"),modelValue:t.phone,"onUpdate:modelValue":s[7]||(s[7]=o=>t.phone=o)},null,8,["label","modelValue"]),i(w,{doctype:"LMS Source",value:t.source,onChange:s[8]||(s[8]=o=>t.source=o),label:e.__("Where did you hear about us?")},null,8,["value","label"]),t.country=="India"?(m(),V(n(u),{key:0,label:e.__("GST Number"),modelValue:t.gstin,"onUpdate:modelValue":s[9]||(s[9]=o=>t.gstin=o)},null,8,["label","modelValue"])):y("",!0),t.country=="India"?(m(),V(n(u),{key:1,label:e.__("Pan Number"),modelValue:t.pan,"onUpdate:modelValue":s[10]||(s[10]=o=>t.pan=o)},null,8,["label","modelValue"])):y("",!0)])]),l("div",ue,[l("p",me,r(e.__("Make sure to enter the right billing name as the same will be used in your invoice.")),1),i(n(x),{variant:"solid",size:"md",onClick:s[11]||(s[11]=o=>B())},{default:C(()=>[v(r(e.__("Proceed to Payment")),1)]),_:1})])])])])):(h=n(_).data)!=null&&h.message?(m(),p("div",ce,[i(P,{text:n(_).data.message,buttonLabel:d.type=="course"?"Checkout Courses":"Checkout Batches",buttonLink:d.type=="course"?"/lms/courses":"/lms/batches"},null,8,["text","buttonLabel","buttonLink"])])):(k=n(g).data)!=null&&k.name?y("",!0):(m(),p("div",_e,[i(P,{text:"Please login to access this page.",buttonLink:`/login?redirect-to=/lms/billing/${d.type}/${d.name}`},null,8,["buttonLink"])]))])}}};export{ye as default};
//# sourceMappingURL=Billing-hMtcApaI.js.map
