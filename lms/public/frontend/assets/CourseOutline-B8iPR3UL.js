var U=(l,v,f)=>new Promise((b,t)=>{var w=c=>{try{C(f.next(c))}catch(u){t(u)}},$=c=>{try{C(f.throw(c))}catch(u){t(u)}},C=c=>c.done?b(c.value):Promise.resolve(c.value).then(w,$);C((f=f.apply(l,v)).next())});import{aq as W,ar as A,a as Z,j as E,w as ee,v as d,x as n,y as p,z as m,J as g,G as N,H as k,C as a,P as te,an as ae,a9 as se,K as R,a5 as L,I as x,q as le,aJ as oe,F as re,f as ie,r as j,aT as ne,ay as ce,B as z,L as I,M as ue,b4 as de,D as H,ap as O,b5 as me,b6 as pe,i as _e}from"./frappe-ui-2-dobwEi.js";import{D as ke}from"./vuedraggable.umd-xDJT7alU.js";import{a as ge,$ as G,a0 as he,a1 as fe,s as y,d as ye,i as ve,ai as be,T as J,aj as Ce,ak as xe,a6 as we}from"./index-Dg_4Jaqk.js";const Se={class:"space-y-4 text-base"},Ee={key:0},Ne={class:"mb-4"},$e={key:1,class:""},De={class:"flex items-center"},Ve={class:"border rounded-md p-2 mr-2"},Le={class:"flex flex-col"},Me={class:"text-sm text-ink-gray-4 mt-1"},Pe={__name:"ChapterModal",props:W({course:{type:String,required:!0},chapterDetail:{type:Object}},{modelValue:{},modelModifiers:{},outline:{},outlineModifiers:{}}),emits:["update:modelValue","update:outline"],setup(l){const v=A(l,"modelValue"),f=A(l,"outline");ge();const b=l,t=Z({title:"",is_scorm_package:0,scorm_package:null}),w=E({url:"lms.lms.api.upsert_chapter",makeParams(s){var o;return{title:t.title,course:b.course,is_scorm_package:t.is_scorm_package,scorm_package:t.scorm_package,name:(o=b.chapterDetail)==null?void 0:o.name}}}),$=E({url:"frappe.client.insert",makeParams(s){return{doc:{doctype:"Chapter Reference",chapter:s.name,parent:b.course,parenttype:"LMS Course",parentfield:"chapters"}}}}),C=s=>U(this,null,function*(){w.submit({},{validate(){return c()},onSuccess:o=>{ye("chapter_created"),$.submit({name:o.name},{onSuccess(r){u(),f.value.reload(),y(__("Success"),__("Chapter added successfully"),"check")},onError(r){var S;y(__("Error"),((S=r.messages)==null?void 0:S[0])||r,"x")}}),s()},onError(o){var r;y(__("Error"),((r=o.messages)==null?void 0:r[0])||o,"x")}})}),c=()=>{if(!t.title)return __("Title is required");if(t.is_scorm_package&&!t.scorm_package)return __("Please upload a SCORM package")},u=()=>{t.title="",t.is_scorm_package=0,t.scorm_package=null},M=s=>{w.submit({},{validate(){if(!t.title)return"Title is required"},onSuccess(){f.value.reload(),y(__("Success"),__("Chapter updated successfully"),"check"),s()},onError(o){var r;y(__("Error"),((r=o.messages)==null?void 0:r[0])||o,"x")}})};ee(()=>b.chapterDetail,s=>{t.title=s==null?void 0:s.title,t.is_scorm_package=s==null?void 0:s.is_scorm_package,t.scorm_package=s==null?void 0:s.scorm_package});const P=s=>{if(s.name.split(".").pop().toLowerCase()!=="zip")return __("Only zip files are allowed")};return(s,o)=>(n(),d(a(le),{modelValue:v.value,"onUpdate:modelValue":o[4]||(o[4]=r=>v.value=r),options:{title:l.chapterDetail?s.__("Edit Chapter"):s.__("Add Chapter"),size:"lg",actions:[{label:l.chapterDetail?s.__("Edit"):s.__("Create"),variant:"solid",onClick:r=>l.chapterDetail?M(r):C(r)}]}},{"body-content":p(()=>[m("div",Se,[g(a(te),{label:"Title",modelValue:t.title,"onUpdate:modelValue":o[0]||(o[0]=r=>t.title=r),required:!0},null,8,["modelValue"]),g(a(ae),{size:"sm",label:s.__("SCORM Package"),description:s.__("Enable this only if you want to upload a SCORM package as a chapter."),modelValue:t.is_scorm_package,"onUpdate:modelValue":o[1]||(o[1]=r=>t.is_scorm_package=r)},null,8,["label","description","modelValue"]),t.is_scorm_package?(n(),N("div",Ee,[t.scorm_package?(n(),N("div",$e,[m("div",De,[m("div",Ve,[g(a(G),{class:"h-5 w-5 stroke-1.5 text-ink-gray-7"})]),m("div",Le,[m("span",null,x(t.scorm_package.file_name),1),m("span",Me,x(a(he)(t.scorm_package.file_size)),1)]),g(a(fe),{onClick:o[3]||(o[3]=()=>t.scorm_package=null),class:"bg-surface-gray-3 rounded-md cursor-pointer stroke-1.5 w-5 h-5 p-1 ml-4"})])])):(n(),d(a(se),{key:0,fileTypes:[".zip"],validateFile:P,onSuccess:o[2]||(o[2]=r=>t.scorm_package=r)},{default:p(({file:r,progress:S,uploading:D,openFileSelector:T})=>[m("div",Ne,[g(a(R),{onClick:T,loading:D},{default:p(()=>[L(x(D?`Uploading ${S}%`:"Upload an zip file"),1)]),_:2},1032,["onClick","loading"])])]),_:1}))])):k("",!0)])]),_:1},8,["modelValue","options"]))}},Te={class:"text-base"},ze={key:0,class:"grid grid-cols-[70%,30%] mb-4 px-2"},Oe={class:"font-semibold text-lg leading-5 text-ink-gray-9"},Re=["onClick"],Fe={class:"flex ml-auto space-x-4"},qe={class:"flex items-center text-sm leading-5 group"},Be={key:1,class:"flex mt-2 mb-4 pl-8"},Je={__name:"CourseOutline",props:{courseName:{type:String,required:!0},showOutline:{type:Boolean,default:!1},title:{type:String,default:""},allowEdit:{type:Boolean,default:!1},getProgress:{type:Boolean,default:!1}},setup(l){const v=oe(),f=re(),b=ie("$user"),t=j(!1),w=j(null),$=ne(),{$dialog:C}=$.appContext.config.globalProperties,c=l,u=E({url:"lms.lms.utils.get_course_outline",cache:["course_outline",c.courseName],params:{course:c.courseName,progress:c.getProgress},auto:!0}),M=E({url:"lms.lms.api.delete_lesson",makeParams(e){return{lesson:e.lesson,chapter:e.chapter}},onSuccess(){u.reload(),y("Success","Lesson deleted successfully","check")}}),P=E({url:"lms.lms.api.update_lesson_index",makeParams(e){return{lesson:e.lesson,sourceChapter:e.sourceChapter,targetChapter:e.targetChapter,idx:e.idx}},onSuccess(){y("Success","Lesson moved successfully","check")}}),s=(e,h)=>{C({title:__("Delete this lesson?"),message:__("Deleting this lesson will permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(V){M.submit({lesson:e,chapter:h}),V()}}]})},o=e=>e==v.params.chapterNumber||e==1,r=(e=null)=>{w.value=e,t.value=!0},S=()=>w.value,D=e=>{P.submit({lesson:e.item.__draggable_context.element.name,sourceChapter:e.from.dataset.chapter,targetChapter:e.to.dataset.chapter,idx:e.newIndex})},T=E({url:"lms.lms.api.delete_chapter",makeParams(e){return{chapter:e.chapter}},onSuccess(){u.reload(),y("Success","Chapter deleted successfully","check")}}),K=e=>{C({title:__("Delete this chapter?"),message:__("Deleting this chapter will also delete all its lessons and permanently remove it from the course. This action cannot be undone. Are you sure you want to continue?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",onClick(h){T.submit({chapter:e}),h()}}]})},Q=e=>{if(e.is_scorm_package&&(event.preventDefault(),!c.allowEdit)){if(!b.data){y(__("You are not enrolled"),__("Please enroll for this course to view this lesson"),"alert-circle");return}f.push({name:"SCORMChapter",params:{courseName:c.courseName,chapterName:e.name}})}},X=e=>v.params.chapterNumber==e.split(".")[0]&&v.params.lessonNumber==e.split(".")[1];return(e,h)=>{var F,q;const V=ce("router-link");return n(),N(I,null,[m("div",Te,[l.title&&((F=a(u).data)!=null&&F.length||l.allowEdit)?(n(),N("div",ze,[m("div",Oe,x(e.__(l.title)),1),l.allowEdit?(n(),d(a(R),{key:0,size:"sm",onClick:h[0]||(h[0]=i=>r())},{default:p(()=>[L(x(e.__("Add Chapter")),1)]),_:1})):k("",!0)])):k("",!0),m("div",{class:z({"border-2 rounded-md py-2 px-2":l.showOutline&&((q=a(u).data)==null?void 0:q.length)})},[(n(!0),N(I,null,ue(a(u).data,(i,Y)=>(n(),d(a(pe),{key:i.name,defaultOpen:o(i.idx)},{default:p(({open:B})=>[g(a(de),{ref_for:!0,ref:"",class:"flex items-center w-full p-2 group"},{default:p(()=>[g(a(ve),{class:z([{"rotate-90 transform duration-200":B,"duration-200":!B,hidden:i.is_scorm_package,open:Y==1},"h-4 w-4 text-ink-gray-9 stroke-1"])},null,8,["class"]),m("div",{class:"text-base text-left text-ink-gray-9 font-medium leading-5 ml-2",onClick:_=>Q(i)},x(i.title),9,Re),m("div",Fe,[g(a(H),{text:e.__("Edit Chapter"),placement:"bottom"},{default:p(()=>[l.allowEdit?(n(),d(a(be),{key:0,onClick:O(_=>r(i),["prevent"]),class:"h-4 w-4 text-ink-gray-9 invisible group-hover:visible"},null,8,["onClick"])):k("",!0)]),_:2},1032,["text"]),g(a(H),{text:e.__("Delete Chapter"),placement:"bottom"},{default:p(()=>[l.allowEdit?(n(),d(a(J),{key:0,onClick:O(_=>K(i.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 invisible group-hover:visible"},null,8,["onClick"])):k("",!0)]),_:2},1032,["text"])])]),_:2},1536),i.is_scorm_package?k("",!0):(n(),d(a(me),{key:0},{default:p(()=>[i.is_scorm_package?k("",!0):(n(),d(a(ke),{key:0,list:i.lessons,disabled:!l.allowEdit,"item-key":"name",group:"items",onEnd:D,"data-chapter":i.name},{item:p(({element:_})=>[m("div",{class:z(["outline-lesson pl-8 py-2 pr-4 text-ink-gray-9",X(_.number)?"bg-surface-selected":""])},[g(V,{to:{name:l.allowEdit?"LessonForm":"Lesson",params:{courseName:l.courseName,chapterNumber:_.number.split(".")[0],lessonNumber:_.number.split(".")[1]}}},{default:p(()=>[m("div",qe,[_.icon==="icon-youtube"?(n(),d(a(Ce),{key:0,class:"h-4 w-4 stroke-1 mr-2"})):_.icon==="icon-quiz"?(n(),d(a(xe),{key:1,class:"h-4 w-4 stroke-1 mr-2"})):_.icon==="icon-list"?(n(),d(a(G),{key:2,class:"h-4 w-4 text-ink-gray-9 stroke-1 mr-2"})):k("",!0),L(" "+x(_.title)+" ",1),l.allowEdit?(n(),d(a(J),{key:3,onClick:O(Ue=>s(_.name,i.name),["prevent"]),class:"h-4 w-4 text-ink-red-3 ml-auto invisible group-hover:visible"},null,8,["onClick"])):k("",!0),_.is_complete?(n(),d(a(we),{key:4,class:"h-4 w-4 text-green-700 ml-2"})):k("",!0)])]),_:2},1032,["to"])],2)]),_:2},1032,["list","disabled","data-chapter"])),l.allowEdit?(n(),N("div",Be,[i.is_scorm_package?k("",!0):(n(),d(V,{key:0,to:{name:"LessonForm",params:{courseName:l.courseName,chapterNumber:i.idx,lessonNumber:i.lessons.length+1}}},{default:p(()=>[g(a(R),null,{default:p(()=>[L(x(e.__("Add Lesson")),1)]),_:1})]),_:2},1032,["to"]))])):k("",!0)]),_:2},1024))]),_:2},1032,["defaultOpen"]))),128))],2)]),g(Pe,{modelValue:t.value,"onUpdate:modelValue":h[1]||(h[1]=i=>t.value=i),outline:a(u),"onUpdate:outline":h[2]||(h[2]=i=>_e(u)?u.value=i:null),course:l.courseName,chapterDetail:S()},null,8,["modelValue","outline","course","chapterDetail"])],64)}}};export{Je as _};
//# sourceMappingURL=CourseOutline-B8iPR3UL.js.map
