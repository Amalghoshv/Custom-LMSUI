var le=Object.defineProperty;var Y=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var Z=(b,m,d)=>m in b?le(b,m,{enumerable:!0,configurable:!0,writable:!0,value:d}):b[m]=d,z=(b,m)=>{for(var d in m||(m={}))oe.call(m,d)&&Z(b,d,m[d]);if(Y)for(var d of Y(m))ne.call(m,d)&&Z(b,d,m[d]);return b};import{aq as ie,ar as ee,r as K,a as T,j as w,w as ae,d as P,v as Q,x as _,y as f,z as u,G as k,H as g,N as se,b8 as te,I as q,J as n,C as l,T as ue,P as p,L as D,M as O,q as re,s as de,f as me,F as _e,a7 as ce,aG as pe,a5 as I,K as x,aN as fe,aP as be,aS as qe,R as ke,i as ye,ay as ve,aO as Ve,aQ as we,aR as he}from"./frappe-ui-2-dobwEi.js";import{q as ze,s as V,b as ge,P as Qe,T as Se}from"./index-Dg_4Jaqk.js";const $e={class:"space-y-4"},xe={key:0,class:"flex items-center text-xs text-ink-gray-7 space-x-5"},De={class:"flex items-center space-x-2"},Me={for:"existing",class:"cursor-pointer"},Ue={class:"flex items-center space-x-2"},Ce={for:"new",class:"cursor-pointer"},Ee={key:1,class:"space-y-2"},Le={class:"block text-xs text-ink-gray-5 mb-1"},Ie={key:0,class:"divide-y border-t"},Pe={class:"space-y-4 py-2"},Te={class:"space-y-2"},Oe={key:2,class:"space-y-2"},je={__name:"Question",props:ie({title:{type:String,default:__("Add a new question")},questionDetail:{type:[Object,null],required:!0}},{modelValue:{},modelModifiers:{},quiz:{},quizModifiers:{}}),emits:["update:modelValue","update:quiz"],setup(b){const m=ee(b,"modelValue"),d=ee(b,"quiz"),y=K(null),h=K(!1),c=T({question:"",marks:0}),s=T({question:"",type:"Choices",marks:0}),S=()=>{let o=["option","is_correct","explanation","possibility"],a=1;o.forEach(e=>{for(;a<=4;)s[`${e}_${a}`]=e==="is_correct"?!1:null,a++})};S();const r=b,M=w({url:"frappe.client.get",makeParams(){return{doctype:"LMS Question",name:r.questionDetail.question}},auto:!1,onSuccess(o){let a=1;for(h.value=!0,Object.keys(o).forEach(e=>{Object.hasOwn(s,e)&&(s[e]=o[e])});a<=4;)s[`is_correct_${a}`]=!!o[`is_correct_${a}`],a++;s.marks=r.questionDetail.marks}});ae(m,()=>{m.value&&(h.value=!1,r.questionDetail.question?M.fetch():(s.question="",s.marks=0,s.type="Choices",c.question="",c.marks=0,y.value=null,S()),r.questionDetail.marks&&(s.marks=r.questionDetail.marks))});const j=w({url:"frappe.client.insert",makeParams(o){return{doc:z({doctype:"LMS Quiz Question",parent:d.value.data.name,parentfield:"questions",parenttype:"LMS Quiz"},o)}}}),U=w({url:"frappe.client.insert",makeParams(o){return{doc:z({doctype:"LMS Question"},s)}}}),N=o=>{var a;(a=r.questionDetail)!=null&&a.question?A(o):R(o)},R=o=>{y.value=="existing"?C({question:c.question,marks:c.marks},o):U.submit({},{onSuccess(a){C({question:a.name,marks:s.marks},o)},onError(a){var e;V(__("Error"),__(((e=a.messages)==null?void 0:e[0])||a),"x")}})},C=(o,a)=>{j.submit(z({},o),{onSuccess(){m.value=!1,V(__("Success"),__("Question added successfully"),"check"),d.value.reload(),a()},onError(e){var t;V(__("Error"),__(((t=e.messages)==null?void 0:t[0])||e),"x"),a()}})},E=w({url:"frappe.client.set_value",auto:!1,makeParams(o){var a;return{doctype:"LMS Question",name:(a=M.data)==null?void 0:a.name,fieldname:z({},s)}}}),L=w({url:"frappe.client.set_value",auto:!1,makeParams(o){return{doctype:"LMS Quiz Question",name:r.questionDetail.name,fieldname:{marks:s.marks}}}}),A=o=>{E.submit({},{onSuccess(){L.submit({},{onSuccess(){m.value=!1,V(__("Success"),__("Question updated successfully"),"check"),d.value.reload(),o()}})},onError(a){var e;V(__("Error"),__(((e=a.messages)==null?void 0:e[0])||a),"x")}})},F=P(()=>({title:__(r.title),size:"xl",actions:[{label:__("Submit"),variant:"solid",onClick:o=>{N(o)}}]}));return(o,a)=>(_(),Q(l(re),{modelValue:m.value,"onUpdate:modelValue":a[7]||(a[7]=e=>m.value=e),options:F.value},{"body-content":f(()=>[u("div",$e,[h.value?g("",!0):(_(),k("div",xe,[u("div",De,[se(u("input",{type:"radio",id:"existing",value:"existing","onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),class:"w-3 h-3 cursor-pointer"},null,512),[[te,y.value]]),u("label",Me,q(o.__("Add an existing question")),1)]),u("div",Ue,[se(u("input",{type:"radio",id:"new",value:"new","onUpdate:modelValue":a[1]||(a[1]=e=>y.value=e),class:"w-3 h-3 cursor-pointer"},null,512),[[te,y.value]]),u("label",Ce,q(o.__("Create a new question")),1)])])),y.value=="new"||h.value?(_(),k("div",Ee,[u("div",null,[u("label",Le,q(o.__("Question")),1),n(l(ue),{content:s.question,onChange:a[2]||(a[2]=e=>s.question=e),editable:!0,fixedMenu:!0,editorClass:"prose-sm max-w-none border-b border-x bg-surface-gray-2 rounded-b-md py-1 px-2 min-h-[7rem]"},null,8,["content"])]),n(l(p),{modelValue:s.marks,"onUpdate:modelValue":a[3]||(a[3]=e=>s.marks=e),label:o.__("Marks"),type:"number"},null,8,["modelValue","label"]),n(l(p),{label:o.__("Type"),modelValue:s.type,"onUpdate:modelValue":a[4]||(a[4]=e=>s.type=e),type:"select",options:["Choices","User Input","Open Ended"],class:"pb-2",required:!0},null,8,["label","modelValue"]),s.type=="Choices"?(_(),k("div",Ie,[(_(),k(D,null,O(4,e=>u("div",Pe,[n(l(p),{label:o.__("Option")+" "+e,modelValue:s[`option_${e}`],"onUpdate:modelValue":t=>s[`option_${e}`]=t,required:e<=2},null,8,["label","modelValue","onUpdate:modelValue","required"]),n(l(p),{label:o.__("Explanation"),modelValue:s[`explanation_${e}`],"onUpdate:modelValue":t=>s[`explanation_${e}`]=t},null,8,["label","modelValue","onUpdate:modelValue"]),n(l(p),{label:o.__("Correct Answer"),modelValue:s[`is_correct_${e}`],"onUpdate:modelValue":t=>s[`is_correct_${e}`]=t,type:"checkbox"},null,8,["label","modelValue","onUpdate:modelValue"])])),64))])):s.type=="User Input"?(_(),k(D,{key:1},O(4,e=>u("div",Te,[n(l(p),{label:o.__("Possibility")+" "+e,modelValue:s[`possibility_${e}`],"onUpdate:modelValue":t=>s[`possibility_${e}`]=t,required:e==1},null,8,["label","modelValue","onUpdate:modelValue","required"])])),64)):g("",!0)])):y.value=="existing"?(_(),k("div",Oe,[n(ze,{modelValue:c.question,"onUpdate:modelValue":a[5]||(a[5]=e=>c.question=e),label:o.__("Select a question"),doctype:"LMS Question"},null,8,["modelValue","label"]),n(l(p),{modelValue:c.marks,"onUpdate:modelValue":a[6]||(a[6]=e=>c.marks=e),label:o.__("Marks"),type:"number"},null,8,["modelValue","label"])])):g("",!0)])]),_:1},8,["modelValue","options"]))}},Ne={class:"sticky top-0 z-10 flex items-center justify-between border-b bg-surface-white px-3 py-2.5 sm:px-5"},Re={class:"space-x-2"},Ae={class:"w-3/4 mx-auto py-5"},Fe={class:"mb-8"},Be={class:"font-semibold mb-4"},He={key:0},Ke={class:"grid grid-cols-2 gap-5 mt-4 mb-8"},Ge={class:"mb-8"},Je={class:"font-semibold mb-4"},We={class:"grid grid-cols-3 gap-5 my-4"},Xe={class:"mb-8"},Ye={class:"font-semibold mb-4"},Ze={class:"grid grid-cols-3"},es={class:"flex items-center justify-between mb-4"},ss={class:"font-semibold"},ts=["innerHTML"],as={key:1,class:"text-xs"},ls={class:"flex gap-2"},us={__name:"QuizForm",props:{quizID:{type:String,required:!0}},setup(b){const m=K(!1),d=T({question:"",marks:0,name:""}),y=me("$user"),h=_e(),c=b,s=T({title:"",total_marks:0,passing_percentage:0,max_attempts:0,duration:0,limit_questions_to:0,show_answers:!0,show_submission_history:!1,shuffle_questions:!1,questions:[]});de(()=>{var e,t;c.quizID=="new"&&!((e=y.data)!=null&&e.is_moderator)&&!((t=y.data)!=null&&t.is_instructor)&&h.push({name:"Courses"}),c.quizID!=="new"&&r.reload(),window.addEventListener("keydown",S)});const S=e=>{e.key==="s"&&(e.ctrlKey||e.metaKey)&&(U(),e.preventDefault())};ce(()=>{window.removeEventListener("keydown",S)}),ae(()=>c.quizID!=="new",e=>{e&&r.reload()});const r=w({url:"frappe.client.get",makeParams(e){return{doctype:"LMS Quiz",name:c.quizID}},auto:!1,onSuccess(e){Object.keys(e).forEach(v=>{Object.hasOwn(s,v)&&(s[v]=e[v])});let t=["show_answers","show_submission_history","shuffle_questions"];for(let v in t){let $=t[v];s[$]=!!s[$]}}}),M=w({url:"frappe.client.insert",auto:!1,makeParams(e){return{doc:z({doctype:"LMS Quiz"},s)}}}),j=w({url:"frappe.client.set_value",auto:!1,makeParams(e){return{doctype:"LMS Quiz",name:e.quizID,fieldname:z({total_marks:C()},s)}}}),U=()=>{var e;(e=r.data)!=null&&e.name?R():N()},N=()=>{M.submit({},{onSuccess(e){V(__("Success"),__("Quiz created successfully"),"check"),h.push({name:"QuizForm",params:{quizID:e.name}})},onError(e){var t;V(__("Error"),__(((t=e.messages)==null?void 0:t[0])||e),"x")}})},R=()=>{var e;j.submit({quizID:(e=r.data)==null?void 0:e.name},{onSuccess(t){s.total_marks=t.total_marks,V(__("Success"),__("Quiz updated successfully"),"check")},onError(t){var v;V(__("Error"),__(((v=t.messages)==null?void 0:v[0])||t),"x")}})},C=()=>{let e=0;return s.limit_questions_to&&s.questions.length>0?s.questions[0].marks*s.limit_questions_to:(s.questions.forEach(t=>{e+=t.marks}),e)},E=P(()=>[{label:__("ID"),key:"question",width:"10rem"},{label:__("Question"),key:__("question_detail"),width:"40rem"},{label:__("Marks"),key:"marks",width:"5rem"}]),L=(e=null)=>{e?(d.question=e.question,d.marks=e.marks,d.name=e.name):(d.question="",d.marks=0,d.name=""),m.value=!0},A=w({url:"lms.lms.api.delete_documents",makeParams(e){return{doctype:"LMS Quiz Question",documents:e.questions}}}),F=(e,t)=>{A.submit({questions:Array.from(e)},{onSuccess(){V(__("Success"),__("Questions deleted successfully"),"check"),r.reload(),t()}})},o=P(()=>{var t;let e=[{label:__("Quizzes"),route:{name:"Quizzes"}}];return e.push({label:c.quizID=="new"?__("New Quiz"):(t=r.data)==null?void 0:t.title,route:{name:"QuizForm",params:{quizID:c.quizID}}}),e}),a=P(()=>{var e;return{title:c.quizID=="new"?__("New Quiz"):(e=r.data)==null?void 0:e.title,description:__("Form to create and edit quizzes")}});return ge(a),(e,t)=>{var $,G,J,W;const v=ve("router-link");return _(),k(D,null,[u("header",Ne,[n(l(pe),{items:o.value},null,8,["items"]),u("div",Re,[($=l(r).data)!=null&&$.name?(_(),Q(v,{key:0,to:{name:"QuizPage",params:{quizID:l(r).data.name}}},{default:f(()=>[n(l(x),null,{default:f(()=>[I(q(e.__("Open")),1)]),_:1})]),_:1},8,["to"])):g("",!0),(G=l(r).data)!=null&&G.name?(_(),Q(v,{key:1,to:{name:"QuizSubmissionList",params:{quizID:l(r).data.name}}},{default:f(()=>[n(l(x),null,{default:f(()=>[I(q(e.__("Submission List")),1)]),_:1})]),_:1},8,["to"])):g("",!0),n(l(x),{variant:"solid",onClick:t[0]||(t[0]=i=>U())},{default:f(()=>[I(q(e.__("Save")),1)]),_:1})])]),u("div",Ae,[u("div",Fe,[u("div",Be,q(e.__("Details")),1),n(l(p),{modelValue:s.title,"onUpdate:modelValue":t[1]||(t[1]=i=>s.title=i),label:(J=l(r).data)!=null&&J.name?e.__("Title"):e.__("Enter a title and save the quiz to proceed"),required:!0},null,8,["modelValue","label"]),(W=l(r).data)!=null&&W.name?(_(),k("div",He,[u("div",Ke,[n(l(p),{type:"number",modelValue:s.max_attempts,"onUpdate:modelValue":t[2]||(t[2]=i=>s.max_attempts=i),label:e.__("Maximun Attempts")},null,8,["modelValue","label"]),n(l(p),{type:"number",modelValue:s.duration,"onUpdate:modelValue":t[3]||(t[3]=i=>s.duration=i),label:e.__("Duration (in minutes)")},null,8,["modelValue","label"]),n(l(p),{modelValue:s.total_marks,"onUpdate:modelValue":t[4]||(t[4]=i=>s.total_marks=i),label:e.__("Total Marks"),disabled:""},null,8,["modelValue","label"]),n(l(p),{modelValue:s.passing_percentage,"onUpdate:modelValue":t[5]||(t[5]=i=>s.passing_percentage=i),label:e.__("Passing Percentage")},null,8,["modelValue","label"])]),u("div",Ge,[u("div",Je,q(e.__("Settings")),1),u("div",We,[n(l(p),{modelValue:s.show_answers,"onUpdate:modelValue":t[6]||(t[6]=i=>s.show_answers=i),type:"checkbox",label:e.__("Show Answers")},null,8,["modelValue","label"]),n(l(p),{modelValue:s.show_submission_history,"onUpdate:modelValue":t[7]||(t[7]=i=>s.show_submission_history=i),type:"checkbox",label:e.__("Show Submission History")},null,8,["modelValue","label"])])]),u("div",Xe,[u("div",Ye,q(e.__("Shuffle Settings")),1),u("div",Ze,[n(l(p),{modelValue:s.shuffle_questions,"onUpdate:modelValue":t[8]||(t[8]=i=>s.shuffle_questions=i),type:"checkbox",label:e.__("Shuffle Questions")},null,8,["modelValue","label"]),s.shuffle_questions?(_(),Q(l(p),{key:0,modelValue:s.limit_questions_to,"onUpdate:modelValue":t[9]||(t[9]=i=>s.limit_questions_to=i),label:e.__("Limit Questions To")},null,8,["modelValue","label"])):g("",!0)])]),u("div",null,[u("div",es,[u("div",ss,q(e.__("Questions")),1),n(l(x),{onClick:t[10]||(t[10]=i=>L())},{prefix:f(()=>[n(l(Qe),{class:"w-4 h-4"})]),default:f(()=>[I(" "+q(e.__("New Question")),1)]),_:1})]),n(l(ke),{columns:E.value,rows:s.questions,"row-key":"name",options:{showTooltip:!1}},{default:f(()=>[n(l(fe),{class:"mb-2 grid items-center space-x-4 rounded bg-surface-gray-2 p-2"},{default:f(()=>[(_(!0),k(D,null,O(E.value,i=>(_(),Q(l(Ve),{item:i},null,8,["item"]))),256))]),_:1}),n(l(be),null,{default:f(()=>[(_(!0),k(D,null,O(s.questions,i=>(_(),Q(l(we),{row:i,onClick:B=>L(i),class:"cursor-pointer"},{default:f(({idx:B,column:X,item:H})=>[n(l(he),{item:H},{default:f(()=>[X.key=="question_detail"?(_(),k("div",{key:0,class:"text-xs truncate h-4",innerHTML:H},null,8,ts)):(_(),k("div",as,q(H),1))]),_:2},1032,["item"])]),_:2},1032,["row","onClick"]))),256))]),_:1}),n(l(qe),null,{actions:f(({unselectAll:i,selections:B})=>[u("div",ls,[n(l(x),{variant:"ghost",onClick:X=>F(B,i)},{default:f(()=>[n(l(Se),{class:"h-4 w-4 stroke-1.5"})]),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["columns","rows"])])])):g("",!0)])]),n(je,{modelValue:m.value,"onUpdate:modelValue":t[11]||(t[11]=i=>m.value=i),questionDetail:d,quiz:l(r),"onUpdate:quiz":t[12]||(t[12]=i=>ye(r)?r.value=i:null),title:d.question?e.__("Edit the question"):e.__("Add a new question")},null,8,["modelValue","questionDetail","quiz","title"])],64)}}};export{us as default};
//# sourceMappingURL=QuizForm-DH9RxVUv.js.map
